import{$ as Fe,Cb as _h,Db as yh,F as To,H as lh,L as Ao,R as hh,T as bo,U as dh,Ub as vh,W as yt,X as fh,Xb as Ih,Z as Ae,a as Ii,aa as Re,b as ah,ba as Ne,ea as ph,f as mt,fc as wh,g as y,ga as vt,ia as mh,j as gt,ja as gh,o as ch,p as uh,pa as mn,qa as So,r as yo,s as vo,sa as Ue,t as Io,u as wo,v as Eo,ya as wi,z as _t}from"./chunk-42U72ICL.js";var dr=class{},Ti=class{},Ze=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let r=t.indexOf(":");if(r>0){let i=t.slice(0,r),s=i.toLowerCase(),a=t.slice(r+1).trim();this.maybeSetNormalizedName(i,s),this.headers.has(s)?this.headers.get(s).push(a):this.headers.set(s,[a])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(e.name,t);let i=(e.op==="a"?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let a=this.headers.get(t);if(!a)return;a=a.filter(c=>s.indexOf(c)===-1),a.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,a)}break}}setHeaderEntries(e,t){let r=(Array.isArray(t)?t:[t]).map(s=>s.toString()),i=e.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var Po=class{encodeKey(e){return Eh(e)}encodeValue(e){return Eh(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function Fm(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(i=>{let s=i.indexOf("="),[a,c]=s==-1?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,s)),e.decodeValue(i.slice(s+1))],h=t.get(a)||[];h.push(c),t.set(a,h)}),t}var Um=/%(\d[a-f0-9])/gi,Bm={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Eh(n){return encodeURIComponent(n).replace(Um,(e,t)=>Bm[t]??e)}function Ei(n){return`${n}`}var wt=class n{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Po,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=Fm(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let r=e.fromObject[t],i=Array.isArray(r)?r.map(Ei):[Ei(r)];this.map.set(t,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(r=>{let i=e[r];Array.isArray(i)?i.forEach(s=>{t.push({param:r,value:s,op:"a"})}):t.push({param:r,value:i,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(Ei(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let r=this.map.get(e.param)||[],i=r.indexOf(Ei(e.value));i!==-1&&r.splice(i,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var Co=class{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function qm(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function Th(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function Ah(n){return typeof Blob<"u"&&n instanceof Blob}function bh(n){return typeof FormData<"u"&&n instanceof FormData}function jm(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var hr=class n{constructor(e,t,r,i){this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase();let s;if(qm(this.method)||i?(this.body=r!==void 0?r:null,s=i):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new Ze,this.context??=new Co,!this.params)this.params=new wt,this.urlWithParams=t;else{let a=this.params.toString();if(a.length===0)this.urlWithParams=t;else{let c=t.indexOf("?"),h=c===-1?"?":c<t.length-1?"&":"";this.urlWithParams=t+h+a}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||Th(this.body)||Ah(this.body)||bh(this.body)||jm(this.body)?this.body:this.body instanceof wt?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||bh(this.body)?null:Ah(this.body)?this.body.type||null:Th(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof wt?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(e={}){let t=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=e.transferCache??this.transferCache,a=e.body!==void 0?e.body:this.body,c=e.withCredentials??this.withCredentials,h=e.reportProgress??this.reportProgress,d=e.headers||this.headers,p=e.params||this.params,v=e.context??this.context;return e.setHeaders!==void 0&&(d=Object.keys(e.setHeaders).reduce((T,R)=>T.set(R,e.setHeaders[R]),d)),e.setParams&&(p=Object.keys(e.setParams).reduce((T,R)=>T.set(R,e.setParams[R]),p)),new n(t,r,a,{params:p,headers:d,context:v,reportProgress:h,responseType:i,withCredentials:c,transferCache:s})}},Et=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(Et||{}),fr=class{constructor(e,t=200,r="OK"){this.headers=e.headers||new Ze,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},Ai=class n extends fr{constructor(e={}){super(e),this.type=Et.ResponseHeader}clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},pr=class n extends fr{constructor(e={}){super(e),this.type=Et.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},It=class extends fr{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},Dh=200,$m=204;function Ro(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var zm=(()=>{let e=class e{constructor(r){this.handler=r}request(r,i,s={}){let a;if(r instanceof hr)a=r;else{let d;s.headers instanceof Ze?d=s.headers:d=new Ze(s.headers);let p;s.params&&(s.params instanceof wt?p=s.params:p=new wt({fromObject:s.params})),a=new hr(r,i,s.body!==void 0?s.body:null,{headers:d,context:s.context,params:p,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}let c=Eo(a).pipe(lh(d=>this.handler.handle(d)));if(r instanceof hr||s.observe==="events")return c;let h=c.pipe(To(d=>d instanceof pr));switch(s.observe||"body"){case"body":switch(a.responseType){case"arraybuffer":return h.pipe(_t(d=>{if(d.body!==null&&!(d.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return d.body}));case"blob":return h.pipe(_t(d=>{if(d.body!==null&&!(d.body instanceof Blob))throw new Error("Response is not a Blob.");return d.body}));case"text":return h.pipe(_t(d=>{if(d.body!==null&&typeof d.body!="string")throw new Error("Response is not a string.");return d.body}));case"json":default:return h.pipe(_t(d=>d.body))}case"response":return h;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(r,i={}){return this.request("DELETE",r,i)}get(r,i={}){return this.request("GET",r,i)}head(r,i={}){return this.request("HEAD",r,i)}jsonp(r,i){return this.request("JSONP",r,{params:new wt().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,i={}){return this.request("OPTIONS",r,i)}patch(r,i,s={}){return this.request("PATCH",r,Ro(s,i))}post(r,i,s={}){return this.request("POST",r,Ro(s,i))}put(r,i,s={}){return this.request("PUT",r,Ro(s,i))}};e.\u0275fac=function(i){return new(i||e)(Fe(dr))},e.\u0275prov=yt({token:e,factory:e.\u0275fac});let n=e;return n})(),Gm=/^\)\]\}',?\n/,Wm="X-Request-URL";function Sh(n){if(n.url)return n.url;let e=Wm.toLocaleLowerCase();return n.headers.get(e)}var Km=(()=>{let e=class e{constructor(){this.fetchImpl=Re(Do,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=Re(Ue)}handle(r){return new gt(i=>{let s=new AbortController;return this.doRequest(r,s.signal,i).then(No,a=>i.error(new It({error:a}))),()=>s.abort()})}doRequest(r,i,s){return y(this,null,function*(){let a=this.createRequestInit(r),c;try{let D=this.ngZone.runOutsideAngular(()=>this.fetchImpl(r.urlWithParams,Ii({signal:i},a)));Qm(D),s.next({type:Et.Sent}),c=yield D}catch(D){s.error(new It({error:D,status:D.status??0,statusText:D.statusText,url:r.urlWithParams,headers:D.headers}));return}let h=new Ze(c.headers),d=c.statusText,p=Sh(c)??r.urlWithParams,v=c.status,T=null;if(r.reportProgress&&s.next(new Ai({headers:h,status:v,statusText:d,url:p})),c.body){let D=c.headers.get("content-length"),O=[],C=c.body.getReader(),V=0,B,z,j=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>y(this,null,function*(){for(;;){let{done:G,value:w}=yield C.read();if(G)break;if(O.push(w),V+=w.length,r.reportProgress){z=r.responseType==="text"?(z??"")+(B??=new TextDecoder).decode(w,{stream:!0}):void 0;let m=()=>s.next({type:Et.DownloadProgress,total:D?+D:void 0,loaded:V,partialText:z});j?j.run(m):m()}}}));let ie=this.concatChunks(O,V);try{let G=c.headers.get("Content-Type")??"";T=this.parseBody(r,ie,G)}catch(G){s.error(new It({error:G,headers:new Ze(c.headers),status:c.status,statusText:c.statusText,url:Sh(c)??r.urlWithParams}));return}}v===0&&(v=T?Dh:0),v>=200&&v<300?(s.next(new pr({body:T,headers:h,status:v,statusText:d,url:p})),s.complete()):s.error(new It({error:T,headers:h,status:v,statusText:d,url:p}))})}parseBody(r,i,s){switch(r.responseType){case"json":let a=new TextDecoder().decode(i).replace(Gm,"");return a===""?null:JSON.parse(a);case"text":return new TextDecoder().decode(i);case"blob":return new Blob([i],{type:s});case"arraybuffer":return i.buffer}}createRequestInit(r){let i={},s=r.withCredentials?"include":void 0;if(r.headers.forEach((a,c)=>i[a]=c.join(",")),r.headers.has("Accept")||(i.Accept="application/json, text/plain, */*"),!r.headers.has("Content-Type")){let a=r.detectContentTypeHeader();a!==null&&(i["Content-Type"]=a)}return{body:r.serializeBody(),method:r.method,headers:i,credentials:s}}concatChunks(r,i){let s=new Uint8Array(i),a=0;for(let c of r)s.set(c,a),a+=c.length;return s}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=yt({token:e,factory:e.\u0275fac});let n=e;return n})(),Do=class{};function No(){}function Qm(n){n.then(No,No)}function Nh(n,e){return e(n)}function Hm(n,e){return(t,r)=>e.intercept(t,{handle:i=>n(i,r)})}function Jm(n,e,t){return(r,i)=>gh(t,()=>e(r,s=>n(s,i)))}var Ym=new Ae(""),ko=new Ae(""),Xm=new Ae(""),kh=new Ae("",{providedIn:"root",factory:()=>!0});function Zm(){let n=null;return(e,t)=>{n===null&&(n=(Re(Ym,{optional:!0})??[]).reduceRight(Hm,Nh));let r=Re(So);if(Re(kh)){let s=r.add();return n(e,t).pipe(Ao(()=>r.remove(s)))}else return n(e,t)}}var Rh=(()=>{let e=class e extends dr{constructor(r,i){super(),this.backend=r,this.injector=i,this.chain=null,this.pendingTasks=Re(So),this.contributeToStability=Re(kh)}handle(r){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(ko),...this.injector.get(Xm,[])]));this.chain=i.reduceRight((s,a)=>Jm(s,a,this.injector),Nh)}if(this.contributeToStability){let i=this.pendingTasks.add();return this.chain(r,s=>this.backend.handle(s)).pipe(Ao(()=>this.pendingTasks.remove(i)))}else return this.chain(r,i=>this.backend.handle(i))}};e.\u0275fac=function(i){return new(i||e)(Fe(Ti),Fe(mh))},e.\u0275prov=yt({token:e,factory:e.\u0275fac});let n=e;return n})();var eg=/^\)\]\}',?\n/;function tg(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var Ph=(()=>{let e=class e{constructor(r){this.xhrFactory=r}handle(r){if(r.method==="JSONP")throw new dh(-2800,!1);let i=this.xhrFactory;return(i.\u0275loadImpl?wo(i.\u0275loadImpl()):Eo(null)).pipe(hh(()=>new gt(a=>{let c=i.build();if(c.open(r.method,r.urlWithParams),r.withCredentials&&(c.withCredentials=!0),r.headers.forEach((C,V)=>c.setRequestHeader(C,V.join(","))),r.headers.has("Accept")||c.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){let C=r.detectContentTypeHeader();C!==null&&c.setRequestHeader("Content-Type",C)}if(r.responseType){let C=r.responseType.toLowerCase();c.responseType=C!=="json"?C:"text"}let h=r.serializeBody(),d=null,p=()=>{if(d!==null)return d;let C=c.statusText||"OK",V=new Ze(c.getAllResponseHeaders()),B=tg(c)||r.url;return d=new Ai({headers:V,status:c.status,statusText:C,url:B}),d},v=()=>{let{headers:C,status:V,statusText:B,url:z}=p(),j=null;V!==$m&&(j=typeof c.response>"u"?c.responseText:c.response),V===0&&(V=j?Dh:0);let ie=V>=200&&V<300;if(r.responseType==="json"&&typeof j=="string"){let G=j;j=j.replace(eg,"");try{j=j!==""?JSON.parse(j):null}catch(w){j=G,ie&&(ie=!1,j={error:w,text:j})}}ie?(a.next(new pr({body:j,headers:C,status:V,statusText:B,url:z||void 0})),a.complete()):a.error(new It({error:j,headers:C,status:V,statusText:B,url:z||void 0}))},T=C=>{let{url:V}=p(),B=new It({error:C,status:c.status||0,statusText:c.statusText||"Unknown Error",url:V||void 0});a.error(B)},R=!1,D=C=>{R||(a.next(p()),R=!0);let V={type:Et.DownloadProgress,loaded:C.loaded};C.lengthComputable&&(V.total=C.total),r.responseType==="text"&&c.responseText&&(V.partialText=c.responseText),a.next(V)},O=C=>{let V={type:Et.UploadProgress,loaded:C.loaded};C.lengthComputable&&(V.total=C.total),a.next(V)};return c.addEventListener("load",v),c.addEventListener("error",T),c.addEventListener("timeout",T),c.addEventListener("abort",T),r.reportProgress&&(c.addEventListener("progress",D),h!==null&&c.upload&&c.upload.addEventListener("progress",O)),c.send(h),a.next({type:Et.Sent}),()=>{c.removeEventListener("error",T),c.removeEventListener("abort",T),c.removeEventListener("load",v),c.removeEventListener("timeout",T),r.reportProgress&&(c.removeEventListener("progress",D),h!==null&&c.upload&&c.upload.removeEventListener("progress",O)),c.readyState!==c.DONE&&c.abort()}})))}};e.\u0275fac=function(i){return new(i||e)(Fe(wh))},e.\u0275prov=yt({token:e,factory:e.\u0275fac});let n=e;return n})(),Oh=new Ae(""),ng="XSRF-TOKEN",rg=new Ae("",{providedIn:"root",factory:()=>ng}),ig="X-XSRF-TOKEN",sg=new Ae("",{providedIn:"root",factory:()=>ig}),bi=class{},og=(()=>{let e=class e{constructor(r,i,s){this.doc=r,this.platform=i,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=Ih(r,this.cookieName),this.lastCookieString=r),this.lastToken}};e.\u0275fac=function(i){return new(i||e)(Fe(vh),Fe(wi),Fe(rg))},e.\u0275prov=yt({token:e,factory:e.\u0275fac});let n=e;return n})();function ag(n,e){let t=n.url.toLowerCase();if(!Re(Oh)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(n);let r=Re(bi).getToken(),i=Re(sg);return r!=null&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,r)})),e(n)}var xh=function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n}(xh||{});function cg(n,e){return{\u0275kind:n,\u0275providers:e}}function ug(...n){let e=[zm,Ph,Rh,{provide:dr,useExisting:Rh},{provide:Ti,useFactory:()=>Re(Km,{optional:!0})??Re(Ph)},{provide:ko,useValue:ag,multi:!0},{provide:Oh,useValue:!0},{provide:bi,useClass:og}];for(let t of n)e.push(...t.\u0275providers);return vt(e)}var Ch=new Ae("");function lg(){return cg(xh.LegacyInterceptors,[{provide:Ch,useFactory:Zm},{provide:ko,useExisting:Ch,multi:!0}])}var RE=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=ph({type:e}),e.\u0275inj=fh({providers:[ug(lg())]});let n=e;return n})();var Lh=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},hg=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],a=n[t++],c=n[t++],h=((i&7)<<18|(s&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},Mh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],a=i+1<n.length,c=a?n[i+1]:0,h=i+2<n.length,d=h?n[i+2]:0,p=s>>2,v=(s&3)<<4|c>>4,T=(c&15)<<2|d>>6,R=d&63;h||(R=64,a||(T=64)),r.push(t[p],t[v],t[T],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Lh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):hg(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let v=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||d==null||v==null)throw new xo;let T=s<<2|c>>4;if(r.push(T),d!==64){let R=c<<4&240|d>>2;if(r.push(R),v!==64){let D=d<<6&192|v;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},xo=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},dg=function(n){let e=Lh(n);return Mh.encodeByteArray(e,!0)},mr=function(n){return dg(n).replace(/\./g,"")},Lo=function(n){try{return Mh.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function fg(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var pg=()=>fg().__FIREBASE_DEFAULTS__,mg=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},gg=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Lo(n[1]);return e&&JSON.parse(e)},Ri=()=>{try{return pg()||mg()||gg()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Mo=n=>{var e,t;return(t=(e=Ri())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Fh=n=>{let e=Mo(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Fo=()=>{var n;return(n=Ri())===null||n===void 0?void 0:n.config},Uo=n=>{var e;return(e=Ri())===null||e===void 0?void 0:e[`_${n}`]};var Si=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Uh(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[mr(JSON.stringify(t)),mr(JSON.stringify(a)),""].join(".")}function le(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Bh(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(le())}function _g(){var n;let e=(n=Ri())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function qh(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function jh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function $h(){let n=le();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function zh(){return!_g()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Bo(){try{return typeof indexedDB=="object"}catch{return!1}}function Gh(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var yg="FirebaseError",Pe=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=yg,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,et.prototype.create)}},et=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?vg(s,r):"Error",c=`${this.serviceName}: ${a} (${i}).`;return new Pe(i,c,r)}};function vg(n,e){return n.replace(Ig,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Ig=/\{\$([^}]+)}/g;function Wh(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function jt(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],a=e[i];if(Vh(s)&&Vh(a)){if(!jt(s,a))return!1}else if(s!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Vh(n){return n!==null&&typeof n=="object"}function gr(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function gn(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function _n(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Kh(n,e){let t=new Vo(n,e);return t.subscribe.bind(t)}var Vo=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");wg(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Oo),i.error===void 0&&(i.error=Oo),i.complete===void 0&&(i.complete=Oo);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function wg(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Oo(){}var DE=4*60*60*1e3;function se(n){return n&&n._delegate?n._delegate:n}var ke=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var $t="[DEFAULT]";var qo=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Si;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Tg(e))try{this.getOrInitializeService({instanceIdentifier:$t})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=$t){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return y(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=$t){return this.instances.has(e)}getOptions(e=$t){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,a]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Eg(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=$t){return this.component?this.component.multipleInstances?e:$t:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Eg(n){return n===$t?void 0:n}function Tg(n){return n.instantiationMode==="EAGER"}var Pi=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new qo(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Ag=[],W=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(W||{}),bg={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},Sg=W.INFO,Rg={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},Pg=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=Rg[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Tt=class{constructor(e){this.name=e,this._logLevel=Sg,this._logHandler=Pg,this._userLogHandler=null,Ag.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?bg[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}};var Cg=(n,e)=>e.some(t=>n instanceof t),Qh,Hh;function Dg(){return Qh||(Qh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ng(){return Hh||(Hh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Jh=new WeakMap,$o=new WeakMap,Yh=new WeakMap,jo=new WeakMap,Go=new WeakMap;function kg(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(Be(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Jh.set(t,n)}).catch(()=>{}),Go.set(e,n),e}function Og(n){if($o.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});$o.set(n,e)}var zo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return $o.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Yh.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Be(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Xh(n){zo=n(zo)}function xg(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(Ci(this),e,...t);return Yh.set(r,e.sort?e.sort():[e]),Be(r)}:Ng().includes(n)?function(...e){return n.apply(Ci(this),e),Be(Jh.get(this))}:function(...e){return Be(n.apply(Ci(this),e))}}function Vg(n){return typeof n=="function"?xg(n):(n instanceof IDBTransaction&&Og(n),Cg(n,Dg())?new Proxy(n,zo):n)}function Be(n){if(n instanceof IDBRequest)return kg(n);if(jo.has(n))return jo.get(n);let e=Vg(n);return e!==n&&(jo.set(n,e),Go.set(e,n)),e}var Ci=n=>Go.get(n);function ed(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(n,e),c=Be(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Be(a.result),h.oldVersion,h.newVersion,Be(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),c.then(h=>{s&&h.addEventListener("close",()=>s()),i&&h.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}var Lg=["get","getKey","getAll","getAllKeys","count"],Mg=["put","add","delete","clear"],Wo=new Map;function Zh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Wo.get(e))return Wo.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=Mg.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Lg.includes(t)))return;let s=function(a,...c){return y(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),d=h.store;return r&&(d=d.index(c.shift())),(yield Promise.all([d[t](...c),i&&h.done]))[0]})};return Wo.set(e,s),s}Xh(n=>ah(Ii({},n),{get:(e,t,r)=>Zh(e,t)||n.get(e,t,r),has:(e,t)=>!!Zh(e,t)||n.has(e,t)}));var Qo=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Fg(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function Fg(n){let e=n.getComponent();return e?.type==="VERSION"}var Ho="@firebase/app",td="0.10.10";var tt=new Tt("@firebase/app"),Ug="@firebase/app-compat",Bg="@firebase/analytics-compat",qg="@firebase/analytics",jg="@firebase/app-check-compat",$g="@firebase/app-check",zg="@firebase/auth",Gg="@firebase/auth-compat",Wg="@firebase/database",Kg="@firebase/database-compat",Qg="@firebase/functions",Hg="@firebase/functions-compat",Jg="@firebase/installations",Yg="@firebase/installations-compat",Xg="@firebase/messaging",Zg="@firebase/messaging-compat",e_="@firebase/performance",t_="@firebase/performance-compat",n_="@firebase/remote-config",r_="@firebase/remote-config-compat",i_="@firebase/storage",s_="@firebase/storage-compat",o_="@firebase/firestore",a_="@firebase/vertexai-preview",c_="@firebase/firestore-compat",u_="firebase",l_="10.13.1";var Jo="[DEFAULT]",h_={[Ho]:"fire-core",[Ug]:"fire-core-compat",[qg]:"fire-analytics",[Bg]:"fire-analytics-compat",[$g]:"fire-app-check",[jg]:"fire-app-check-compat",[zg]:"fire-auth",[Gg]:"fire-auth-compat",[Wg]:"fire-rtdb",[Kg]:"fire-rtdb-compat",[Qg]:"fire-fn",[Hg]:"fire-fn-compat",[Jg]:"fire-iid",[Yg]:"fire-iid-compat",[Xg]:"fire-fcm",[Zg]:"fire-fcm-compat",[e_]:"fire-perf",[t_]:"fire-perf-compat",[n_]:"fire-rc",[r_]:"fire-rc-compat",[i_]:"fire-gcs",[s_]:"fire-gcs-compat",[o_]:"fire-fst",[c_]:"fire-fst-compat",[a_]:"fire-vertex","fire-js":"fire-js",[u_]:"fire-js-all"};var _r=new Map,d_=new Map,Yo=new Map;function nd(n,e){try{n.container.addComponent(e)}catch(t){tt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function bt(n){let e=n.name;if(Yo.has(e))return tt.debug(`There were multiple attempts to register component ${e}.`),!1;Yo.set(e,n);for(let t of _r.values())nd(t,n);for(let t of d_.values())nd(t,n);return!0}function vr(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ve(n){return n.settings!==void 0}var f_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},At=new et("app","Firebase",f_);var Xo=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ke("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw At.create("app-deleted",{appName:this._name})}};var St=l_;function ta(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:Jo,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw At.create("bad-app-name",{appName:String(i)});if(t||(t=Fo()),!t)throw At.create("no-options");let s=_r.get(i);if(s){if(jt(t,s.options)&&jt(r,s.config))return s;throw At.create("duplicate-app",{appName:i})}let a=new Pi(i);for(let h of Yo.values())a.addComponent(h);let c=new Xo(t,r,a);return _r.set(i,c),c}function yn(n=Jo){let e=_r.get(n);if(!e&&n===Jo&&Fo())return ta();if(!e)throw At.create("no-app",{appName:n});return e}function Di(){return Array.from(_r.values())}function ue(n,e,t){var r;let i=(r=h_[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),tt.warn(c.join(" "));return}bt(new ke(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var p_="firebase-heartbeat-database",m_=1,yr="firebase-heartbeat-store",Ko=null;function od(){return Ko||(Ko=ed(p_,m_,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(yr)}catch(t){console.warn(t)}}}}).catch(n=>{throw At.create("idb-open",{originalErrorMessage:n.message})})),Ko}function g_(n){return y(this,null,function*(){try{let t=(yield od()).transaction(yr),r=yield t.objectStore(yr).get(ad(n));return yield t.done,r}catch(e){if(e instanceof Pe)tt.warn(e.message);else{let t=At.create("idb-get",{originalErrorMessage:e?.message});tt.warn(t.message)}}})}function rd(n,e){return y(this,null,function*(){try{let r=(yield od()).transaction(yr,"readwrite");yield r.objectStore(yr).put(e,ad(n)),yield r.done}catch(t){if(t instanceof Pe)tt.warn(t.message);else{let r=At.create("idb-set",{originalErrorMessage:t?.message});tt.warn(r.message)}}})}function ad(n){return`${n.name}!${n.options.appId}`}var __=1024,y_=30*24*60*60*1e3,Zo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new ea(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return y(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=id();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{let c=new Date(a.date).valueOf();return Date.now()-c<=y_}),this._storage.overwrite(this._heartbeatsCache))}catch(r){tt.warn(r)}})}getHeartbeatsHeader(){return y(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=id(),{heartbeatsToSend:r,unsentEntries:i}=v_(this._heartbeatsCache.heartbeats),s=mr(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return tt.warn(t),""}})}};function id(){return new Date().toISOString().substring(0,10)}function v_(n,e=__){let t=[],r=n.slice();for(let i of n){let s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),sd(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),sd(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var ea=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return y(this,null,function*(){return Bo()?Gh().then(()=>!0).catch(()=>!1):!1})}read(){return y(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield g_(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return y(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return rd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return y(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return rd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function sd(n){return mr(JSON.stringify({version:2,heartbeats:n})).length}function I_(n){bt(new ke("platform-logger",e=>new Qo(e),"PRIVATE")),bt(new ke("heartbeat",e=>new Zo(e),"PRIVATE")),ue(Ho,td,n),ue(Ho,td,"esm2017"),ue("fire-js","")}I_("");var w_="firebase",E_="10.13.1";ue(w_,E_,"app");var Gt=new _h("ANGULARFIRE2_VERSION");function ki(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(a=>a.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Ir=(n,e)=>{let t=e?[e]:Di(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},In=class{constructor(){return Ir(T_)}},T_="app-check";function vn(){}var Ni=class{zone;delegate;constructor(e,t=uh){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(a){i.runGuarded(()=>{e.apply(this,[a])})};return this.delegate.schedule(s,t,r)}},na=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",vn,{},vn,vn)),t.pipe(bo({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},wn=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Ni(Zone.current)),this.insideAngular=t.run(()=>new Ni(Zone.current,ch)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(Fe(Ue))};static \u0275prov=yt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Oi(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function A_(n){return Oi().ngZone.runOutsideAngular(()=>n())}function zt(n){return Oi().ngZone.run(()=>n())}function b_(n){return S_(Oi())(n)}function S_(n){return function(t){return t=t.lift(new na(n.ngZone)),t.pipe(Io(n.outsideAngular),vo(n.insideAngular))}}var R_=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),zt(()=>n.apply(void 0,r))},he=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=zt(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",vn,{},vn,vn))),r[s]=R_(r[s],t));let i=A_(()=>n.apply(this,r));if(!e)if(i instanceof gt){let s=Oi();return i.pipe(Io(s.outsideAngular),vo(s.insideAngular))}else return zt(()=>i);return i instanceof gt?i.pipe(b_):i instanceof Promise?zt(()=>new Promise((s,a)=>i.then(c=>zt(()=>s(c)),c=>zt(()=>a(c))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:zt(()=>i)};var nt=class{constructor(e){return e}},Wt=class{constructor(){return Di()}};function P_(n){return n&&n.length===1?n[0]:new nt(yn())}var ra=new Ae("angularfire2._apps"),C_={provide:nt,useFactory:P_,deps:[[new Ne,ra]]},D_={provide:Wt,deps:[[new Ne,ra]]};function N_(n){return(e,t)=>{let r=t.get(wi);ue("angularfire",Gt.full,"core"),ue("angularfire",Gt.full,"app"),ue("angular",yh.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new nt(i)}}function gT(n,...e){return vt([C_,D_,{provide:ra,useFactory:N_(n),multi:!0,deps:[Ue,mn,wn,...e]}])}var _T=he(ta,!0);function Ad(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var bd=Ad,Sd=new et("auth","Firebase",Ad());var Ui=new Tt("@firebase/auth");function k_(n,...e){Ui.logLevel<=W.WARN&&Ui.warn(`Auth (${St}): ${n}`,...e)}function Vi(n,...e){Ui.logLevel<=W.ERROR&&Ui.error(`Auth (${St}): ${n}`,...e)}function je(n,...e){throw Sa(n,...e)}function Kt(n,...e){return Sa(n,...e)}function Rd(n,e,t){let r=Object.assign(Object.assign({},bd()),{[e]:t});return new et("auth","Firebase",r).create(e,{appName:n.name})}function st(n){return Rd(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Sa(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Sd.create(n,...e)}function F(n,e,...t){if(!n)throw Sa(e,...t)}function rt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Vi(e),new Error(e)}function Pt(n,e){n||rt(e)}function aa(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function O_(){return cd()==="http:"||cd()==="https:"}function cd(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function x_(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(O_()||qh()||"connection"in navigator)?navigator.onLine:!0}function V_(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Qt=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Pt(t>e,"Short delay should be less than long delay!"),this.isMobile=Bh()||jh()}get(){return x_()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Ra(n,e){Pt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Bi=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;rt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;rt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;rt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var L_={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var M_=new Qt(3e4,6e4);function Ct(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Dt(s,a,c,h){return y(this,arguments,function*(n,e,t,r,i={}){return Pd(n,i,()=>y(this,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let v=gr(Object.assign({key:n.config.apiKey},p)).slice(1),T=yield n._getAdditionalHeaders();return T["Content-Type"]="application/json",n.languageCode&&(T["X-Firebase-Locale"]=n.languageCode),Bi.fetch()(Cd(n,n.config.apiHost,t,v),Object.assign({method:e,headers:T,referrerPolicy:"no-referrer"},d))}))})}function Pd(n,e,t){return y(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},L_),e);try{let i=new ca(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield s.json();if("needConfirmation"in a)throw xi(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{let c=s.ok?a.errorMessage:a.error.message,[h,d]=c.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw xi(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw xi(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw xi(n,"user-disabled",a);let p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Rd(n,p,d);je(n,p)}}catch(i){if(i instanceof Pe)throw i;je(n,"network-request-failed",{message:String(i)})}})}function Pr(s,a,c,h){return y(this,arguments,function*(n,e,t,r,i={}){let d=yield Dt(n,e,t,r,i);return"mfaPendingCredential"in d&&je(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function Cd(n,e,t,r){let i=`${e}${t}?${r}`;return n.config.emulator?Ra(n.config,i):`${n.config.apiScheme}://${i}`}function F_(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var ca=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Kt(this.auth,"network-request-failed")),M_.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function xi(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Kt(n,e,r);return i.customData._tokenResponse=t,i}function ud(n){return n!==void 0&&n.enterprise!==void 0}var ua=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return F_(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}};function U_(n,e){return y(this,null,function*(){return Dt(n,"GET","/v2/recaptchaConfig",Ct(n,e))})}function B_(n,e){return y(this,null,function*(){return Dt(n,"POST","/v1/accounts:delete",e)})}function Dd(n,e){return y(this,null,function*(){return Dt(n,"POST","/v1/accounts:lookup",e)})}function wr(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Pa(n,e=!1){return y(this,null,function*(){let t=se(n),r=yield t.getIdToken(e),i=Ca(r);F(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:r,authTime:wr(ia(i.auth_time)),issuedAtTime:wr(ia(i.iat)),expirationTime:wr(ia(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function ia(n){return Number(n)*1e3}function Ca(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Vi("JWT malformed, contained fewer than 3 sections"),null;try{let i=Lo(t);return i?JSON.parse(i):(Vi("Failed to decode base64 JWT payload"),null)}catch(i){return Vi("Caught error parsing JWT payload as JSON",i?.toString()),null}}function ld(n){let e=Ca(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Tr(n,e,t=!1){return y(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Pe&&q_(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function q_({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var la=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>y(this,null,function*(){yield this.iteration()}),t)}iteration(){return y(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Ar=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=wr(this.lastLoginAt),this.creationTime=wr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function qi(n){return y(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Tr(n,Dd(t,{idToken:r}));F(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let a=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Nd(s.providerUserInfo):[],c=j_(n.providerData,a),h=n.isAnonymous,d=!(n.email&&s.passwordHash)&&!c?.length,p=h?d:!1,v={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new Ar(s.createdAt,s.lastLoginAt),isAnonymous:p};Object.assign(n,v)})}function Da(n){return y(this,null,function*(){let e=se(n);yield qi(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function j_(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Nd(n){return n.map(e=>{var{providerId:t}=e,r=yo(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function $_(n,e){return y(this,null,function*(){let t=yield Pd(n,{},()=>y(this,null,function*(){let r=gr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=Cd(n,i,"/v1/token",`key=${s}`),c=yield n._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",Bi.fetch()(a,{method:"POST",headers:c,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function z_(n,e){return y(this,null,function*(){return Dt(n,"POST","/v2/accounts:revokeToken",Ct(n,e))})}var Er=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ld(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");let t=ld(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return y(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return y(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield $_(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new n;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(F(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(F(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return rt("not implemented")}};function Rt(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var En=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=yo(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new la(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Ar(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return y(this,null,function*(){let t=yield Tr(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Pa(this,e)}reload(){return Da(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return y(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield qi(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return y(this,null,function*(){if(Ve(this.auth.app))return Promise.reject(st(this.auth));let e=yield this.getIdToken();return yield Tr(this,B_(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,a,c,h,d,p;let v=(r=t.displayName)!==null&&r!==void 0?r:void 0,T=(i=t.email)!==null&&i!==void 0?i:void 0,R=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,D=(a=t.photoURL)!==null&&a!==void 0?a:void 0,O=(c=t.tenantId)!==null&&c!==void 0?c:void 0,C=(h=t._redirectEventId)!==null&&h!==void 0?h:void 0,V=(d=t.createdAt)!==null&&d!==void 0?d:void 0,B=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:z,emailVerified:j,isAnonymous:ie,providerData:G,stsTokenManager:w}=t;F(z&&w,e,"internal-error");let m=Er.fromJSON(this.name,w);F(typeof z=="string",e,"internal-error"),Rt(v,e.name),Rt(T,e.name),F(typeof j=="boolean",e,"internal-error"),F(typeof ie=="boolean",e,"internal-error"),Rt(R,e.name),Rt(D,e.name),Rt(O,e.name),Rt(C,e.name),Rt(V,e.name),Rt(B,e.name);let _=new n({uid:z,auth:e,email:T,emailVerified:j,displayName:v,isAnonymous:ie,photoURL:D,phoneNumber:R,tenantId:O,stsTokenManager:m,createdAt:V,lastLoginAt:B});return G&&Array.isArray(G)&&(_.providerData=G.map(I=>Object.assign({},I))),C&&(_._redirectEventId=C),_}static _fromIdTokenResponse(e,t,r=!1){return y(this,null,function*(){let i=new Er;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield qi(s),s})}static _fromGetAccountInfoResponse(e,t,r){return y(this,null,function*(){let i=t.users[0];F(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Nd(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!s?.length,c=new Er;c.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Ar(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(h,d),h})}};var hd=new Map;function it(n){Pt(n instanceof Function,"Expected a class definition");let e=hd.get(n);return e?(Pt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,hd.set(n,e),e)}var G_=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return y(this,null,function*(){return!0})}_set(t,r){return y(this,null,function*(){this.storage[t]=r})}_get(t){return y(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return y(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),ha=G_;function Li(n,e,t){return`firebase:${n}:${e}:${t}`}var ji=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=Li(this.userKey,i.apiKey,s),this.fullPersistenceKey=Li("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return y(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?En._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return y(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return y(this,null,function*(){if(!t.length)return new n(it(ha),e,r);let i=(yield Promise.all(t.map(d=>y(this,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),s=i[0]||it(ha),a=Li(r,e.config.apiKey,e.name),c=null;for(let d of t)try{let p=yield d._get(a);if(p){let v=En._fromJSON(e,p);d!==s&&(c=v),s=d;break}}catch{}let h=i.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!h.length?new n(s,e,r):(s=h[0],c&&(yield s._set(a,c.toJSON())),yield Promise.all(t.map(d=>y(this,null,function*(){if(d!==s)try{yield d._remove(a)}catch{}}))),new n(s,e,r))})}};function dd(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Vd(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(kd(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Md(e))return"Blackberry";if(Fd(e))return"Webos";if(Od(e))return"Safari";if((e.includes("chrome/")||xd(e))&&!e.includes("edge/"))return"Chrome";if(Ld(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function kd(n=le()){return/firefox\//i.test(n)}function Od(n=le()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xd(n=le()){return/crios\//i.test(n)}function Vd(n=le()){return/iemobile/i.test(n)}function Ld(n=le()){return/android/i.test(n)}function Md(n=le()){return/blackberry/i.test(n)}function Fd(n=le()){return/webos/i.test(n)}function Na(n=le()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function W_(n=le()){var e;return Na(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function K_(){return $h()&&document.documentMode===10}function Ud(n=le()){return Na(n)||Ld(n)||Fd(n)||Md(n)||/windows phone/i.test(n)||Vd(n)}function Bd(n,e=[]){let t;switch(n){case"Browser":t=dd(le());break;case"Worker":t=`${dd(le())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${St}/${r}`}var da=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((a,c)=>{try{let h=e(s);a(h)}catch(h){c(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return y(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Q_(t){return y(this,arguments,function*(n,e={}){return Dt(n,"GET","/v2/passwordPolicy",Ct(n,e))})}var H_=6,fa=class{constructor(e){var t,r,i,s;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:H_,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,a,c;let h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(t=h.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),h.isValid&&(h.isValid=(r=h.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(i=h.containsLowercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(s=h.containsUppercaseLetter)!==null&&s!==void 0?s:!0),h.isValid&&(h.isValid=(a=h.containsNumericCharacter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(c=h.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),h}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var pa=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new $i(this),this.idTokenSubscription=new $i(this),this.beforeStateQueue=new da(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Sd,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=it(t)),this._initializationPromise=this.queue(()=>y(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield ji.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return y(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return y(this,null,function*(){try{let t=yield Dd(this,{idToken:e}),r=yield En._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return y(this,null,function*(){var t;if(Ve(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i?._redirectEventId,h=yield this.tryRedirectSignIn(e);(!a||a===c)&&h?.user&&(i=h.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return y(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return y(this,null,function*(){try{yield qi(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=V_()}_delete(){return y(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return y(this,null,function*(){if(Ve(this.app))return Promise.reject(st(this));let t=e?se(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return y(this,null,function*(){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>y(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return y(this,null,function*(){return Ve(this.app)?Promise.reject(st(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Ve(this.app)?Promise.reject(st(this)):this.queue(()=>y(this,null,function*(){yield this.assertedPersistence.setPersistence(it(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return y(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return y(this,null,function*(){let e=yield Q_(this),t=new fa(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new et("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return y(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield z_(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return y(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return y(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&it(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=yield ji.create(this,[it(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return y(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>y(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return y(this,null,function*(){if(e===this.currentUser)return this.queue(()=>y(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),a=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(c,this,"internal-error"),c.then(()=>{a||s(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}directlySetCurrentUser(e){return y(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Bd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return y(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return y(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&k_(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Jt(n){return se(n)}var $i=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Kh(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Ji={loadJS(){return y(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function J_(n){Ji=n}function qd(n){return Ji.loadJS(n)}function Y_(){return Ji.recaptchaEnterpriseScript}function X_(){return Ji.gapiScript}function jd(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var Z_="recaptcha-enterprise",ey="NO_RECAPTCHA",ma=class{constructor(e){this.type=Z_,this.auth=Jt(e)}verify(e="verify",t=!1){return y(this,null,function*(){function r(s){return y(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((a,c)=>y(this,null,function*(){U_(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let d=new ua(h);return s.tenantId==null?s._agentRecaptchaConfig=d:s._tenantRecaptchaConfigs[s.tenantId]=d,a(d.siteKey)}}).catch(h=>{c(h)})}))})}function i(s,a,c){let h=window.grecaptcha;ud(h)?h.enterprise.ready(()=>{h.enterprise.execute(s,{action:e}).then(d=>{a(d)}).catch(()=>{a(ey)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,a)=>{r(this.auth).then(c=>{if(!t&&ud(window.grecaptcha))i(c,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=Y_();h.length!==0&&(h+=c),qd(h).then(()=>{i(c,s,a)}).catch(d=>{a(d)})}}).catch(c=>{a(c)})})})}};function fd(n,e,t,r=!1){return y(this,null,function*(){let i=new ma(n),s;try{s=yield i.verify(t)}catch{s=yield i.verify(t,!0)}let a=Object.assign({},e);return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a})}function ga(n,e,t,r){return y(this,null,function*(){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let s=yield fd(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(s=>y(this,null,function*(){if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let a=yield fd(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(s)}))})}function ka(n,e){let t=vr(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(jt(s,e??{}))return i;je(i,"already-initialized")}return t.initialize({options:e})}function ty(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(it);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Oa(n,e,t){let r=Jt(n);F(r._canInitEmulator,r,"emulator-config-failed"),F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=$d(e),{host:a,port:c}=ny(e),h=c===null?"":`:${c}`;r.config.emulator={url:`${s}//${a}${h}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||ry()}function $d(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ny(n){let e=$d(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:pd(r.substr(s.length+1))}}else{let[s,a]=r.split(":");return{host:s,port:pd(a)}}}function pd(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function ry(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var br=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return rt("not implemented")}_getIdTokenResponse(e){return rt("not implemented")}_linkToIdToken(e,t){return rt("not implemented")}_getReauthenticationResolver(e){return rt("not implemented")}};function iy(n,e){return y(this,null,function*(){return Dt(n,"POST","/v1/accounts:signUp",e)})}function sy(n,e){return y(this,null,function*(){return Pr(n,"POST","/v1/accounts:signInWithPassword",Ct(n,e))})}function oy(n,e){return y(this,null,function*(){return Pr(n,"POST","/v1/accounts:signInWithEmailLink",Ct(n,e))})}function ay(n,e){return y(this,null,function*(){return Pr(n,"POST","/v1/accounts:signInWithEmailLink",Ct(n,e))})}var Sr=class n extends br{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return y(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ga(e,t,"signInWithPassword",sy);case"emailLink":return oy(e,{email:this._email,oobCode:this._password});default:je(e,"internal-error")}})}_linkToIdToken(e,t){return y(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ga(e,r,"signUpPassword",iy);case"emailLink":return ay(e,{idToken:t,email:this._email,oobCode:this._password});default:je(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function sa(n,e){return y(this,null,function*(){return Pr(n,"POST","/v1/accounts:signInWithIdp",Ct(n,e))})}function cy(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function uy(n){let e=gn(_n(n)).link,t=e?gn(_n(e)).deep_link_id:null,r=gn(_n(n)).deep_link_id;return(r?gn(_n(r)).link:null)||r||t||e||n}var zi=class n{constructor(e){var t,r,i,s,a,c;let h=gn(_n(e)),d=(t=h.apiKey)!==null&&t!==void 0?t:null,p=(r=h.oobCode)!==null&&r!==void 0?r:null,v=cy((i=h.mode)!==null&&i!==void 0?i:null);F(d&&p&&v,"argument-error"),this.apiKey=d,this.operation=v,this.code=p,this.continueUrl=(s=h.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(a=h.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(c=h.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=uy(e);try{return new n(t)}catch{return null}}};var zd=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return Sr._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=zi.parseLink(r);return F(i,"argument-error"),Sr._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),Gi=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var _a=class extends Gi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function ly(n,e){return y(this,null,function*(){return Pr(n,"POST","/v1/accounts:signUp",Ct(n,e))})}var Tn=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return y(this,null,function*(){let s=yield En._fromIdTokenResponse(e,r,i),a=md(r);return new n({user:s,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return y(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=md(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function md(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var ya=class n extends Pe{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function Gd(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?ya._fromErrorAndOperation(n,s,e,r):s})}function hy(n,e,t=!1){return y(this,null,function*(){let r=yield Tr(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return Tn._forOperation(n,"link",r)})}function dy(n,e,t=!1){return y(this,null,function*(){let{auth:r}=n;if(Ve(r.app))return Promise.reject(st(r));let i="reauthenticate";try{let s=yield Tr(n,Gd(r,i,e,n),t);F(s.idToken,r,"internal-error");let a=Ca(s.idToken);F(a,r,"internal-error");let{sub:c}=a;return F(n.uid===c,r,"user-mismatch"),Tn._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&je(r,"user-mismatch"),s}})}function Wd(n,e,t=!1){return y(this,null,function*(){if(Ve(n.app))return Promise.reject(st(n));let r="signIn",i=yield Gd(n,r,e),s=yield Tn._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function xa(n,e){return y(this,null,function*(){return Wd(Jt(n),e)})}function Kd(n){return y(this,null,function*(){let e=Jt(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function Va(n,e,t){return y(this,null,function*(){if(Ve(n.app))return Promise.reject(st(n));let r=Jt(n),a=yield ga(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ly).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&Kd(n),h}),c=yield Tn._fromIdTokenResponse(r,"signIn",a);return yield r._updateCurrentUser(c.user),c})}function La(n,e,t){return Ve(n.app)?Promise.reject(st(n)):xa(se(n),zd.credential(e,t)).catch(r=>y(this,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&Kd(n),r}))}function Ma(n,e,t,r){return se(n).onIdTokenChanged(e,t,r)}function Fa(n,e,t){return se(n).beforeAuthStateChanged(e,t)}function Ua(n,e,t,r){return se(n).onAuthStateChanged(e,t,r)}function Ba(n){return se(n).signOut()}var Wi="__sak";var Ki=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Wi,"1"),this.storage.removeItem(Wi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var fy=1e3,py=10,my=(()=>{class n extends Ki{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ud(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((c,h,d)=>{this.notifyListeners(c,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!r&&this.localCache[i]===c||this.notifyListeners(i,c)},a=this.storage.getItem(i);K_()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,py):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},fy)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return y(this,null,function*(){yield mt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return y(this,null,function*(){let r=yield mt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return y(this,null,function*(){yield mt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),Qd=my;var gy=(()=>{class n extends Ki{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),qa=gy;function _y(n){return Promise.all(n.map(e=>y(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var yy=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return y(this,null,function*(){let r=t,{eventId:i,eventType:s,data:a}=r.data,c=this.handlersMap[s];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let h=Array.from(c).map(p=>y(this,null,function*(){return p(r.origin,a)})),d=yield _y(h);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Hd(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var va=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return y(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((c,h)=>{let d=Hd("",20);i.port1.start();let p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(v){let T=v;if(T.data.eventId===d)switch(T.data.status){case"ack":clearTimeout(p),s=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(T.data.response);break;default:clearTimeout(p),clearTimeout(s),h(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function qe(){return window}function vy(n){qe().location.href=n}function Jd(){return typeof qe().WorkerGlobalScope<"u"&&typeof qe().importScripts=="function"}function Iy(){return y(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function wy(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Ey(){return Jd()?self:null}var Yd="firebaseLocalStorageDb",Ty=1,Qi="firebaseLocalStorage",Xd="fbase_key",Ht=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Yi(n,e){return n.transaction([Qi],e?"readwrite":"readonly").objectStore(Qi)}function Ay(){let n=indexedDB.deleteDatabase(Yd);return new Ht(n).toPromise()}function Ia(){let n=indexedDB.open(Yd,Ty);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Qi,{keyPath:Xd})}catch(i){t(i)}}),n.addEventListener("success",()=>y(this,null,function*(){let r=n.result;r.objectStoreNames.contains(Qi)?e(r):(r.close(),yield Ay(),e(yield Ia()))}))})}function gd(n,e,t){return y(this,null,function*(){let r=Yi(n,!0).put({[Xd]:e,value:t});return new Ht(r).toPromise()})}function by(n,e){return y(this,null,function*(){let t=Yi(n,!1).get(e),r=yield new Ht(t).toPromise();return r===void 0?null:r.value})}function _d(n,e){let t=Yi(n,!0).delete(e);return new Ht(t).toPromise()}var Sy=800,Ry=3,Py=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return y(this,null,function*(){return this.db?this.db:(this.db=yield Ia(),this.db)})}_withRetries(t){return y(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>Ry)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return y(this,null,function*(){return Jd()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return y(this,null,function*(){this.receiver=yy._getInstance(Ey()),this.receiver._subscribe("keyChanged",(t,r)=>y(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>y(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return y(this,null,function*(){var t,r;if(this.activeServiceWorker=yield Iy(),!this.activeServiceWorker)return;this.sender=new va(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return y(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||wy()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return y(this,null,function*(){try{if(!indexedDB)return!1;let t=yield Ia();return yield gd(t,Wi,"1"),yield _d(t,Wi),!0}catch{}return!1})}_withPendingWrite(t){return y(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return y(this,null,function*(){return this._withPendingWrite(()=>y(this,null,function*(){return yield this._withRetries(i=>gd(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return y(this,null,function*(){let r=yield this._withRetries(i=>by(i,t));return this.localCache[t]=r,r})}_remove(t){return y(this,null,function*(){return this._withPendingWrite(()=>y(this,null,function*(){return yield this._withRetries(r=>_d(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return y(this,null,function*(){let t=yield this._withRetries(s=>{let a=Yi(s,!1).getAll();return new Ht(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:a}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(a)&&(this.notifyListeners(s,a),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>y(this,null,function*(){return this._poll()}),Sy)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Zd=Py;var bT=jd("rcb"),ST=new Qt(3e4,6e4);function Cy(n,e){return e?it(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Rr=class extends br{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return sa(e,this._buildIdpRequest())}_linkToIdToken(e,t){return sa(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return sa(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function Dy(n){return Wd(n.auth,new Rr(n),n.bypassAuthState)}function Ny(n){let{auth:e,user:t}=n;return F(t,e,"internal-error"),dy(t,new Rr(n),n.bypassAuthState)}function ky(n){return y(this,null,function*(){let{auth:e,user:t}=n;return F(t,e,"internal-error"),hy(t,new Rr(n),n.bypassAuthState)})}var wa=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>y(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return y(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:a,type:c}=e;if(a){this.reject(a);return}let h={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(h))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Dy;case"linkViaPopup":case"linkViaRedirect":return ky;case"reauthViaPopup":case"reauthViaRedirect":return Ny;default:je(this.auth,"internal-error")}}resolve(e){Pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var RT=new Qt(2e3,1e4);var Oy="pendingRedirect",Mi=new Map,Ea=class n extends wa{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return y(this,null,function*(){let e=Mi.get(this.auth._key());if(!e){try{let r=(yield xy(this.resolver,this.auth))?yield mt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Mi.set(this.auth._key(),e)}return this.bypassAuthState||Mi.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return y(this,null,function*(){if(e.type==="signInViaRedirect")return mt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,mt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return y(this,null,function*(){})}cleanUp(){}};function xy(n,e){return y(this,null,function*(){let t=My(e),r=Ly(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function Vy(n,e){Mi.set(n._key(),e)}function Ly(n){return it(n._redirectPersistence)}function My(n){return Li(Oy,n.config.apiKey,n.name)}function Fy(n,e,t=!1){return y(this,null,function*(){if(Ve(n.app))return Promise.reject(st(n));let r=Jt(n),i=Cy(r,e),a=yield new Ea(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var Uy=10*60*1e3,Ta=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!By(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!ef(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Kt(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Uy&&this.cachedEventUids.clear(),this.cachedEventUids.has(yd(e))}saveEventToCache(e){this.cachedEventUids.add(yd(e)),this.lastProcessedEventTime=Date.now()}};function yd(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function ef({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function By(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ef(n);default:return!1}}function qy(t){return y(this,arguments,function*(n,e={}){return Dt(n,"GET","/v1/projects",e)})}var jy=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$y=/^https?/;function zy(n){return y(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield qy(n);for(let t of e)try{if(Gy(t))return}catch{}je(n,"unauthorized-domain")})}function Gy(n){let e=aa(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!$y.test(t))return!1;if(jy.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var Wy=new Qt(3e4,6e4);function vd(){let n=qe().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Ky(n){return new Promise((e,t)=>{var r,i,s;function a(){vd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vd(),t(Kt(n,"network-request-failed"))},timeout:Wy.get()})}if(!((i=(r=qe().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=qe().gapi)===null||s===void 0)&&s.load)a();else{let c=jd("iframefcb");return qe()[c]=()=>{gapi.load?a():t(Kt(n,"network-request-failed"))},qd(`${X_()}?onload=${c}`).catch(h=>t(h))}}).catch(e=>{throw Fi=null,e})}var Fi=null;function Qy(n){return Fi=Fi||Ky(n),Fi}var Hy=new Qt(5e3,15e3),Jy="__/auth/iframe",Yy="emulator/auth/iframe",Xy={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Zy=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ev(n){let e=n.config;F(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Ra(e,Yy):`https://${n.config.authDomain}/${Jy}`,r={apiKey:e.apiKey,appName:n.name,v:St},i=Zy.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${gr(r).slice(1)}`}function tv(n){return y(this,null,function*(){let e=yield Qy(n),t=qe().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:ev(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Xy,dontclear:!0},r=>new Promise((i,s)=>y(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=Kt(n,"network-request-failed"),c=qe().setTimeout(()=>{s(a)},Hy.get());function h(){qe().clearTimeout(c),i(r)}r.ping(h).then(h,()=>{s(a)})})))})}var nv={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},rv=500,iv=600,sv="_blank",ov="http://localhost",Hi=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function av(n,e,t,r=rv,i=iv){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",h=Object.assign(Object.assign({},nv),{width:r.toString(),height:i.toString(),top:s,left:a}),d=le().toLowerCase();t&&(c=xd(d)?sv:t),kd(d)&&(e=e||ov,h.scrollbars="yes");let p=Object.entries(h).reduce((T,[R,D])=>`${T}${R}=${D},`,"");if(W_(d)&&c!=="_self")return cv(e||"",c),new Hi(null);let v=window.open(e||"",c,p);F(v,n,"popup-blocked");try{v.focus()}catch{}return new Hi(v)}function cv(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var uv="__/auth/handler",lv="emulator/auth/handler",hv=encodeURIComponent("fac");function Id(n,e,t,r,i,s){return y(this,null,function*(){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:St,eventId:i};if(e instanceof Gi){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Wh(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,v]of Object.entries(s||{}))a[p]=v}if(e instanceof _a){let p=e.getScopes().filter(v=>v!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let c=a;for(let p of Object.keys(c))c[p]===void 0&&delete c[p];let h=yield n._getAppCheckToken(),d=h?`#${hv}=${encodeURIComponent(h)}`:"";return`${dv(n)}?${gr(c).slice(1)}${d}`})}function dv({config:n}){return n.emulator?Ra(n,lv):`https://${n.authDomain}/${uv}`}var oa="webStorageSupport",Aa=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=qa,this._completeRedirectFn=Fy,this._overrideRedirectResult=Vy}_openPopup(e,t,r,i){return y(this,null,function*(){var s;Pt((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let a=yield Id(e,t,r,aa(),i);return av(e,a,Hd())})}_openRedirect(e,t,r,i){return y(this,null,function*(){yield this._originValidation(e);let s=yield Id(e,t,r,aa(),i);return vy(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Pt(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return y(this,null,function*(){let t=yield tv(e),r=new Ta(e);return t.register("authEvent",i=>(F(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(oa,{type:oa},i=>{var s;let a=(s=i?.[0])===null||s===void 0?void 0:s[oa];a!==void 0&&t(!!a),je(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=zy(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ud()||Od()||Na()}},tf=Aa;var wd="@firebase/auth",Ed="1.7.8";var ba=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return y(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function fv(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function pv(n){bt(new ke("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Bd(n)},d=new pa(r,i,s,h);return ty(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),bt(new ke("auth-internal",e=>{let t=Jt(e.getProvider("auth").getImmediate());return(r=>new ba(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ue(wd,Ed,fv(n)),ue(wd,Ed,"esm2017")}var mv=5*60,gv=Uo("authIdTokenMaxAge")||mv,Td=null,_v=n=>e=>y(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>gv)return;let i=t?.token;Td!==i&&(Td=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function ja(n=yn()){let e=vr(n,"auth");if(e.isInitialized())return e.getImmediate();let t=ka(n,{popupRedirectResolver:tf,persistence:[Zd,Qd,qa]}),r=Uo("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let a=_v(s.toString());Fa(t,a,()=>a(t.currentUser)),Ma(t,c=>a(c))}}let i=Mo("auth");return i&&Oa(t,`http://${i}`),t}function yv(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}J_({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=Kt("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",yv().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});pv("Browser");var nf="auth",Cr=class{constructor(e){return e}},Dr=class{constructor(){return Ir(nf)}};var $a=new Ae("angularfire2.auth-instances");function aI(n,e){let t=ki(nf,n,e);return t&&new Cr(t)}function cI(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Cr(r)}}var uI={provide:Dr,deps:[[new Ne,$a]]},lI={provide:Cr,useFactory:aI,deps:[[new Ne,$a],nt]};function lA(n,...e){return ue("angularfire",Gt.full,"auth"),vt([lI,uI,{provide:$a,useFactory:cI(n),multi:!0,deps:[Ue,mn,wn,Wt,[new Ne,In],...e]}])}var hA=he(Va,!0);var dA=he(ja,!0);var fA=he(Ua,!0);var pA=he(La,!0);var mA=he(Ba,!0);var rf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},sf={};var Nt,za;(function(){var n;function e(w,m){function _(){}_.prototype=m.prototype,w.D=m.prototype,w.prototype=new _,w.prototype.constructor=w,w.C=function(I,E,b){for(var g=Array(arguments.length-2),Je=2;Je<arguments.length;Je++)g[Je-2]=arguments[Je];return m.prototype[E].apply(I,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,m,_){_||(_=0);var I=Array(16);if(typeof m=="string")for(var E=0;16>E;++E)I[E]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(E=0;16>E;++E)I[E]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=w.g[0],_=w.g[1],E=w.g[2];var b=w.g[3],g=m+(b^_&(E^b))+I[0]+3614090360&4294967295;m=_+(g<<7&4294967295|g>>>25),g=b+(E^m&(_^E))+I[1]+3905402710&4294967295,b=m+(g<<12&4294967295|g>>>20),g=E+(_^b&(m^_))+I[2]+606105819&4294967295,E=b+(g<<17&4294967295|g>>>15),g=_+(m^E&(b^m))+I[3]+3250441966&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(b^_&(E^b))+I[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(E^m&(_^E))+I[5]+1200080426&4294967295,b=m+(g<<12&4294967295|g>>>20),g=E+(_^b&(m^_))+I[6]+2821735955&4294967295,E=b+(g<<17&4294967295|g>>>15),g=_+(m^E&(b^m))+I[7]+4249261313&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(b^_&(E^b))+I[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(E^m&(_^E))+I[9]+2336552879&4294967295,b=m+(g<<12&4294967295|g>>>20),g=E+(_^b&(m^_))+I[10]+4294925233&4294967295,E=b+(g<<17&4294967295|g>>>15),g=_+(m^E&(b^m))+I[11]+2304563134&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(b^_&(E^b))+I[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(E^m&(_^E))+I[13]+4254626195&4294967295,b=m+(g<<12&4294967295|g>>>20),g=E+(_^b&(m^_))+I[14]+2792965006&4294967295,E=b+(g<<17&4294967295|g>>>15),g=_+(m^E&(b^m))+I[15]+1236535329&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(E^b&(_^E))+I[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^E&(m^_))+I[6]+3225465664&4294967295,b=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(b^m))+I[11]+643717713&4294967295,E=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(E^b))+I[0]+3921069994&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(E^b&(_^E))+I[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^E&(m^_))+I[10]+38016083&4294967295,b=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(b^m))+I[15]+3634488961&4294967295,E=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(E^b))+I[4]+3889429448&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(E^b&(_^E))+I[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^E&(m^_))+I[14]+3275163606&4294967295,b=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(b^m))+I[3]+4107603335&4294967295,E=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(E^b))+I[8]+1163531501&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(E^b&(_^E))+I[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^E&(m^_))+I[2]+4243563512&4294967295,b=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(b^m))+I[7]+1735328473&4294967295,E=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(E^b))+I[12]+2368359562&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(_^E^b)+I[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^E)+I[8]+2272392833&4294967295,b=m+(g<<11&4294967295|g>>>21),g=E+(b^m^_)+I[11]+1839030562&4294967295,E=b+(g<<16&4294967295|g>>>16),g=_+(E^b^m)+I[14]+4259657740&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(_^E^b)+I[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^E)+I[4]+1272893353&4294967295,b=m+(g<<11&4294967295|g>>>21),g=E+(b^m^_)+I[7]+4139469664&4294967295,E=b+(g<<16&4294967295|g>>>16),g=_+(E^b^m)+I[10]+3200236656&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(_^E^b)+I[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^E)+I[0]+3936430074&4294967295,b=m+(g<<11&4294967295|g>>>21),g=E+(b^m^_)+I[3]+3572445317&4294967295,E=b+(g<<16&4294967295|g>>>16),g=_+(E^b^m)+I[6]+76029189&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(_^E^b)+I[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^E)+I[12]+3873151461&4294967295,b=m+(g<<11&4294967295|g>>>21),g=E+(b^m^_)+I[15]+530742520&4294967295,E=b+(g<<16&4294967295|g>>>16),g=_+(E^b^m)+I[2]+3299628645&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(E^(_|~b))+I[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~E))+I[7]+1126891415&4294967295,b=m+(g<<10&4294967295|g>>>22),g=E+(m^(b|~_))+I[14]+2878612391&4294967295,E=b+(g<<15&4294967295|g>>>17),g=_+(b^(E|~m))+I[5]+4237533241&4294967295,_=E+(g<<21&4294967295|g>>>11),g=m+(E^(_|~b))+I[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~E))+I[3]+2399980690&4294967295,b=m+(g<<10&4294967295|g>>>22),g=E+(m^(b|~_))+I[10]+4293915773&4294967295,E=b+(g<<15&4294967295|g>>>17),g=_+(b^(E|~m))+I[1]+2240044497&4294967295,_=E+(g<<21&4294967295|g>>>11),g=m+(E^(_|~b))+I[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~E))+I[15]+4264355552&4294967295,b=m+(g<<10&4294967295|g>>>22),g=E+(m^(b|~_))+I[6]+2734768916&4294967295,E=b+(g<<15&4294967295|g>>>17),g=_+(b^(E|~m))+I[13]+1309151649&4294967295,_=E+(g<<21&4294967295|g>>>11),g=m+(E^(_|~b))+I[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~E))+I[11]+3174756917&4294967295,b=m+(g<<10&4294967295|g>>>22),g=E+(m^(b|~_))+I[2]+718787259&4294967295,E=b+(g<<15&4294967295|g>>>17),g=_+(b^(E|~m))+I[9]+3951481745&4294967295,w.g[0]=w.g[0]+m&4294967295,w.g[1]=w.g[1]+(E+(g<<21&4294967295|g>>>11))&4294967295,w.g[2]=w.g[2]+E&4294967295,w.g[3]=w.g[3]+b&4294967295}r.prototype.u=function(w,m){m===void 0&&(m=w.length);for(var _=m-this.blockSize,I=this.B,E=this.h,b=0;b<m;){if(E==0)for(;b<=_;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<m;)if(I[E++]=w.charCodeAt(b++),E==this.blockSize){i(this,I),E=0;break}}else for(;b<m;)if(I[E++]=w[b++],E==this.blockSize){i(this,I),E=0;break}}this.h=E,this.o+=m},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var m=1;m<w.length-8;++m)w[m]=0;var _=8*this.o;for(m=w.length-8;m<w.length;++m)w[m]=_&255,_/=256;for(this.u(w),w=Array(16),m=_=0;4>m;++m)for(var I=0;32>I;I+=8)w[_++]=this.g[m]>>>I&255;return w};function s(w,m){var _=c;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=m(w)}function a(w,m){this.h=m;for(var _=[],I=!0,E=w.length-1;0<=E;E--){var b=w[E]|0;I&&b==m||(_[E]=b,I=!1)}this.g=_}var c={};function h(w){return-128<=w&&128>w?s(w,function(m){return new a([m|0],0>m?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return v;if(0>w)return C(d(-w));for(var m=[],_=1,I=0;w>=_;I++)m[I]=w/_|0,_*=4294967296;return new a(m,0)}function p(w,m){if(w.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(w.charAt(0)=="-")return C(p(w.substring(1),m));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=d(Math.pow(m,8)),I=v,E=0;E<w.length;E+=8){var b=Math.min(8,w.length-E),g=parseInt(w.substring(E,E+b),m);8>b?(b=d(Math.pow(m,b)),I=I.j(b).add(d(g))):(I=I.j(_),I=I.add(d(g)))}return I}var v=h(0),T=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(O(this))return-C(this).m();for(var w=0,m=1,_=0;_<this.g.length;_++){var I=this.i(_);w+=(0<=I?I:4294967296+I)*m,m*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(D(this))return"0";if(O(this))return"-"+C(this).toString(w);for(var m=d(Math.pow(w,6)),_=this,I="";;){var E=j(_,m).g;_=V(_,E.j(m));var b=((0<_.g.length?_.g[0]:_.h)>>>0).toString(w);if(_=E,D(_))return b+I;for(;6>b.length;)b="0"+b;I=b+I}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function D(w){if(w.h!=0)return!1;for(var m=0;m<w.g.length;m++)if(w.g[m]!=0)return!1;return!0}function O(w){return w.h==-1}n.l=function(w){return w=V(this,w),O(w)?-1:D(w)?0:1};function C(w){for(var m=w.g.length,_=[],I=0;I<m;I++)_[I]=~w.g[I];return new a(_,~w.h).add(T)}n.abs=function(){return O(this)?C(this):this},n.add=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0,E=0;E<=m;E++){var b=I+(this.i(E)&65535)+(w.i(E)&65535),g=(b>>>16)+(this.i(E)>>>16)+(w.i(E)>>>16);I=g>>>16,b&=65535,g&=65535,_[E]=g<<16|b}return new a(_,_[_.length-1]&-2147483648?-1:0)};function V(w,m){return w.add(C(m))}n.j=function(w){if(D(this)||D(w))return v;if(O(this))return O(w)?C(this).j(C(w)):C(C(this).j(w));if(O(w))return C(this.j(C(w)));if(0>this.l(R)&&0>w.l(R))return d(this.m()*w.m());for(var m=this.g.length+w.g.length,_=[],I=0;I<2*m;I++)_[I]=0;for(I=0;I<this.g.length;I++)for(var E=0;E<w.g.length;E++){var b=this.i(I)>>>16,g=this.i(I)&65535,Je=w.i(E)>>>16,Wn=w.i(E)&65535;_[2*I+2*E]+=g*Wn,B(_,2*I+2*E),_[2*I+2*E+1]+=b*Wn,B(_,2*I+2*E+1),_[2*I+2*E+1]+=g*Je,B(_,2*I+2*E+1),_[2*I+2*E+2]+=b*Je,B(_,2*I+2*E+2)}for(I=0;I<m;I++)_[I]=_[2*I+1]<<16|_[2*I];for(I=m;I<2*m;I++)_[I]=0;return new a(_,0)};function B(w,m){for(;(w[m]&65535)!=w[m];)w[m+1]+=w[m]>>>16,w[m]&=65535,m++}function z(w,m){this.g=w,this.h=m}function j(w,m){if(D(m))throw Error("division by zero");if(D(w))return new z(v,v);if(O(w))return m=j(C(w),m),new z(C(m.g),C(m.h));if(O(m))return m=j(w,C(m)),new z(C(m.g),m.h);if(30<w.g.length){if(O(w)||O(m))throw Error("slowDivide_ only works with positive integers.");for(var _=T,I=m;0>=I.l(w);)_=ie(_),I=ie(I);var E=G(_,1),b=G(I,1);for(I=G(I,2),_=G(_,2);!D(I);){var g=b.add(I);0>=g.l(w)&&(E=E.add(_),b=g),I=G(I,1),_=G(_,1)}return m=V(w,E.j(m)),new z(E,m)}for(E=v;0<=w.l(m);){for(_=Math.max(1,Math.floor(w.m()/m.m())),I=Math.ceil(Math.log(_)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),b=d(_),g=b.j(m);O(g)||0<g.l(w);)_-=I,b=d(_),g=b.j(m);D(b)&&(b=T),E=E.add(b),w=V(w,g)}return new z(E,w)}n.A=function(w){return j(this,w).h},n.and=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0;I<m;I++)_[I]=this.i(I)&w.i(I);return new a(_,this.h&w.h)},n.or=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0;I<m;I++)_[I]=this.i(I)|w.i(I);return new a(_,this.h|w.h)},n.xor=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0;I<m;I++)_[I]=this.i(I)^w.i(I);return new a(_,this.h^w.h)};function ie(w){for(var m=w.g.length+1,_=[],I=0;I<m;I++)_[I]=w.i(I)<<1|w.i(I-1)>>>31;return new a(_,w.h)}function G(w,m){var _=m>>5;m%=32;for(var I=w.g.length-_,E=[],b=0;b<I;b++)E[b]=0<m?w.i(b+_)>>>m|w.i(b+_+1)<<32-m:w.i(b+_);return new a(E,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,za=sf.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,Nt=sf.Integer=a}).apply(typeof rf<"u"?rf:typeof self<"u"?self:typeof window<"u"?window:{});var Xi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ot={};var Ga,Wa,An,Ka,Nr,Zi,Qa,Ha,Ja;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,u,l){return o==Array.prototype||o==Object.prototype||(o[u]=l.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Xi=="object"&&Xi];for(var u=0;u<o.length;++u){var l=o[u];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function i(o,u){if(u)e:{var l=r;o=o.split(".");for(var f=0;f<o.length-1;f++){var A=o[f];if(!(A in l))break e;l=l[A]}o=o[o.length-1],f=l[o],u=u(f),u!=f&&u!=null&&e(l,o,{configurable:!0,writable:!0,value:u})}}function s(o,u){o instanceof String&&(o+="");var l=0,f=!1,A={next:function(){if(!f&&l<o.length){var S=l++;return{value:u(S,o[S]),done:!1}}return f=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(o){return o||function(){return s(this,function(u,l){return l})}});var a=a||{},c=this||self;function h(o){var u=typeof o;return u=u!="object"?u:o?Array.isArray(o)?"array":u:"null",u=="array"||u=="object"&&typeof o.length=="number"}function d(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function p(o,u,l){return o.call.apply(o.bind,arguments)}function v(o,u,l){if(!o)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,f),o.apply(u,A)}}return function(){return o.apply(u,arguments)}}function T(o,u,l){return T=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:v,T.apply(null,arguments)}function R(o,u){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function D(o,u){function l(){}l.prototype=u.prototype,o.aa=u.prototype,o.prototype=new l,o.prototype.constructor=o,o.Qb=function(f,A,S){for(var k=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)k[Y-2]=arguments[Y];return u.prototype[A].apply(f,k)}}function O(o){let u=o.length;if(0<u){let l=Array(u);for(let f=0;f<u;f++)l[f]=o[f];return l}return[]}function C(o,u){for(let l=1;l<arguments.length;l++){let f=arguments[l];if(h(f)){let A=o.length||0,S=f.length||0;o.length=A+S;for(let k=0;k<S;k++)o[A+k]=f[k]}else o.push(f)}}class V{constructor(u,l){this.i=u,this.j=l,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function B(o){return/^[\s\xa0]*$/.test(o)}function z(){var o=c.navigator;return o&&(o=o.userAgent)?o:""}function j(o){return j[" "](o),o}j[" "]=function(){};var ie=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function G(o,u,l){for(let f in o)u.call(l,o[f],f,o)}function w(o,u){for(let l in o)u.call(void 0,o[l],l,o)}function m(o){let u={};for(let l in o)u[l]=o[l];return u}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(o,u){let l,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(l in f)o[l]=f[l];for(let S=0;S<_.length;S++)l=_[S],Object.prototype.hasOwnProperty.call(f,l)&&(o[l]=f[l])}}function E(o){var u=1;o=o.split(":");let l=[];for(;0<u&&o.length;)l.push(o.shift()),u--;return o.length&&l.push(o.join(":")),l}function b(o){c.setTimeout(()=>{throw o},0)}function g(){var o=Ws;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class Je{constructor(){this.h=this.g=null}add(u,l){let f=Wn.get();f.set(u,l),this.h?this.h.next=f:this.g=f,this.h=f}}var Wn=new V(()=>new rm,o=>o.reset());class rm{constructor(){this.next=this.g=this.h=null}set(u,l){this.h=u,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let Kn,Qn=!1,Ws=new Je,ol=()=>{let o=c.Promise.resolve(void 0);Kn=()=>{o.then(im)}};var im=()=>{for(var o;o=g();){try{o.h.call(o.g)}catch(l){b(l)}var u=Wn;u.j(o),100>u.h&&(u.h++,o.next=u.g,u.g=o)}Qn=!1};function ht(){this.s=this.s,this.C=this.C}ht.prototype.s=!1,ht.prototype.ma=function(){this.s||(this.s=!0,this.N())},ht.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function me(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}me.prototype.h=function(){this.defaultPrevented=!0};var sm=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let l=()=>{};c.addEventListener("test",l,u),c.removeEventListener("test",l,u)}catch{}return o}();function Hn(o,u){if(me.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var l=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget){if(ie){e:{try{j(u.nodeName);var A=!0;break e}catch{}A=!1}A||(u=null)}}else l=="mouseover"?u=o.fromElement:l=="mouseout"&&(u=o.toElement);this.relatedTarget=u,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:om[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Hn.aa.h.call(this)}}D(Hn,me);var om={2:"touch",3:"pen",4:"mouse"};Hn.prototype.h=function(){Hn.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Jn="closure_listenable_"+(1e6*Math.random()|0),am=0;function cm(o,u,l,f,A){this.listener=o,this.proxy=null,this.src=u,this.type=l,this.capture=!!f,this.ha=A,this.key=++am,this.da=this.fa=!1}function ri(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function ii(o){this.src=o,this.g={},this.h=0}ii.prototype.add=function(o,u,l,f,A){var S=o.toString();o=this.g[S],o||(o=this.g[S]=[],this.h++);var k=Qs(o,u,f,A);return-1<k?(u=o[k],l||(u.fa=!1)):(u=new cm(u,this.src,S,!!f,A),u.fa=l,o.push(u)),u};function Ks(o,u){var l=u.type;if(l in o.g){var f=o.g[l],A=Array.prototype.indexOf.call(f,u,void 0),S;(S=0<=A)&&Array.prototype.splice.call(f,A,1),S&&(ri(u),o.g[l].length==0&&(delete o.g[l],o.h--))}}function Qs(o,u,l,f){for(var A=0;A<o.length;++A){var S=o[A];if(!S.da&&S.listener==u&&S.capture==!!l&&S.ha==f)return A}return-1}var Hs="closure_lm_"+(1e6*Math.random()|0),Js={};function al(o,u,l,f,A){if(f&&f.once)return ul(o,u,l,f,A);if(Array.isArray(u)){for(var S=0;S<u.length;S++)al(o,u[S],l,f,A);return null}return l=eo(l),o&&o[Jn]?o.K(u,l,d(f)?!!f.capture:!!f,A):cl(o,u,l,!1,f,A)}function cl(o,u,l,f,A,S){if(!u)throw Error("Invalid event type");var k=d(A)?!!A.capture:!!A,Y=Xs(o);if(Y||(o[Hs]=Y=new ii(o)),l=Y.add(u,l,f,k,S),l.proxy)return l;if(f=um(),l.proxy=f,f.src=o,f.listener=l,o.addEventListener)sm||(A=k),A===void 0&&(A=!1),o.addEventListener(u.toString(),f,A);else if(o.attachEvent)o.attachEvent(hl(u.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function um(){function o(l){return u.call(o.src,o.listener,l)}let u=lm;return o}function ul(o,u,l,f,A){if(Array.isArray(u)){for(var S=0;S<u.length;S++)ul(o,u[S],l,f,A);return null}return l=eo(l),o&&o[Jn]?o.L(u,l,d(f)?!!f.capture:!!f,A):cl(o,u,l,!0,f,A)}function ll(o,u,l,f,A){if(Array.isArray(u))for(var S=0;S<u.length;S++)ll(o,u[S],l,f,A);else f=d(f)?!!f.capture:!!f,l=eo(l),o&&o[Jn]?(o=o.i,u=String(u).toString(),u in o.g&&(S=o.g[u],l=Qs(S,l,f,A),-1<l&&(ri(S[l]),Array.prototype.splice.call(S,l,1),S.length==0&&(delete o.g[u],o.h--)))):o&&(o=Xs(o))&&(u=o.g[u.toString()],o=-1,u&&(o=Qs(u,l,f,A)),(l=-1<o?u[o]:null)&&Ys(l))}function Ys(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[Jn])Ks(u.i,o);else{var l=o.type,f=o.proxy;u.removeEventListener?u.removeEventListener(l,f,o.capture):u.detachEvent?u.detachEvent(hl(l),f):u.addListener&&u.removeListener&&u.removeListener(f),(l=Xs(u))?(Ks(l,o),l.h==0&&(l.src=null,u[Hs]=null)):ri(o)}}}function hl(o){return o in Js?Js[o]:Js[o]="on"+o}function lm(o,u){if(o.da)o=!0;else{u=new Hn(u,this);var l=o.listener,f=o.ha||o.src;o.fa&&Ys(o),o=l.call(f,u)}return o}function Xs(o){return o=o[Hs],o instanceof ii?o:null}var Zs="__closure_events_fn_"+(1e9*Math.random()>>>0);function eo(o){return typeof o=="function"?o:(o[Zs]||(o[Zs]=function(u){return o.handleEvent(u)}),o[Zs])}function ge(){ht.call(this),this.i=new ii(this),this.M=this,this.F=null}D(ge,ht),ge.prototype[Jn]=!0,ge.prototype.removeEventListener=function(o,u,l,f){ll(this,o,u,l,f)};function Ee(o,u){var l,f=o.F;if(f)for(l=[];f;f=f.F)l.push(f);if(o=o.M,f=u.type||u,typeof u=="string")u=new me(u,o);else if(u instanceof me)u.target=u.target||o;else{var A=u;u=new me(f,o),I(u,A)}if(A=!0,l)for(var S=l.length-1;0<=S;S--){var k=u.g=l[S];A=si(k,f,!0,u)&&A}if(k=u.g=o,A=si(k,f,!0,u)&&A,A=si(k,f,!1,u)&&A,l)for(S=0;S<l.length;S++)k=u.g=l[S],A=si(k,f,!1,u)&&A}ge.prototype.N=function(){if(ge.aa.N.call(this),this.i){var o=this.i,u;for(u in o.g){for(var l=o.g[u],f=0;f<l.length;f++)ri(l[f]);delete o.g[u],o.h--}}this.F=null},ge.prototype.K=function(o,u,l,f){return this.i.add(String(o),u,!1,l,f)},ge.prototype.L=function(o,u,l,f){return this.i.add(String(o),u,!0,l,f)};function si(o,u,l,f){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();for(var A=!0,S=0;S<u.length;++S){var k=u[S];if(k&&!k.da&&k.capture==l){var Y=k.listener,fe=k.ha||k.src;k.fa&&Ks(o.i,k),A=Y.call(fe,f)!==!1&&A}}return A&&!f.defaultPrevented}function dl(o,u,l){if(typeof o=="function")l&&(o=T(o,l));else if(o&&typeof o.handleEvent=="function")o=T(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(o,u||0)}function fl(o){o.g=dl(()=>{o.g=null,o.i&&(o.i=!1,fl(o))},o.l);let u=o.h;o.h=null,o.m.apply(null,u)}class hm extends ht{constructor(u,l){super(),this.m=u,this.l=l,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:fl(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yn(o){ht.call(this),this.h=o,this.g={}}D(Yn,ht);var pl=[];function ml(o){G(o.g,function(u,l){this.g.hasOwnProperty(l)&&Ys(u)},o),o.g={}}Yn.prototype.N=function(){Yn.aa.N.call(this),ml(this)},Yn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var to=c.JSON.stringify,dm=c.JSON.parse,fm=class{stringify(o){return c.JSON.stringify(o,void 0)}parse(o){return c.JSON.parse(o,void 0)}};function no(){}no.prototype.h=null;function gl(o){return o.h||(o.h=o.i())}function _l(){}var Xn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ro(){me.call(this,"d")}D(ro,me);function io(){me.call(this,"c")}D(io,me);var Ft={},yl=null;function oi(){return yl=yl||new ge}Ft.La="serverreachability";function vl(o){me.call(this,Ft.La,o)}D(vl,me);function Zn(o){let u=oi();Ee(u,new vl(u))}Ft.STAT_EVENT="statevent";function Il(o,u){me.call(this,Ft.STAT_EVENT,o),this.stat=u}D(Il,me);function Te(o){let u=oi();Ee(u,new Il(u,o))}Ft.Ma="timingevent";function wl(o,u){me.call(this,Ft.Ma,o),this.size=u}D(wl,me);function er(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){o()},u)}function tr(){this.g=!0}tr.prototype.xa=function(){this.g=!1};function pm(o,u,l,f,A,S){o.info(function(){if(o.g)if(S)for(var k="",Y=S.split("&"),fe=0;fe<Y.length;fe++){var H=Y[fe].split("=");if(1<H.length){var _e=H[0];H=H[1];var ye=_e.split("_");k=2<=ye.length&&ye[1]=="type"?k+(_e+"="+H+"&"):k+(_e+"=redacted&")}}else k=null;else k=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+u+`
`+l+`
`+k})}function mm(o,u,l,f,A,S,k){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+u+`
`+l+`
`+S+" "+k})}function hn(o,u,l,f){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+_m(o,l)+(f?" "+f:"")})}function gm(o,u){o.info(function(){return"TIMEOUT: "+u})}tr.prototype.info=function(){};function _m(o,u){if(!o.g)return u;if(!u)return null;try{var l=JSON.parse(u);if(l){for(o=0;o<l.length;o++)if(Array.isArray(l[o])){var f=l[o];if(!(2>f.length)){var A=f[1];if(Array.isArray(A)&&!(1>A.length)){var S=A[0];if(S!="noop"&&S!="stop"&&S!="close")for(var k=1;k<A.length;k++)A[k]=""}}}}return to(l)}catch{return u}}var ai={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},El={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},so;function ci(){}D(ci,no),ci.prototype.g=function(){return new XMLHttpRequest},ci.prototype.i=function(){return{}},so=new ci;function dt(o,u,l,f){this.j=o,this.i=u,this.l=l,this.R=f||1,this.U=new Yn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Tl}function Tl(){this.i=null,this.g="",this.h=!1}var Al={},oo={};function ao(o,u,l){o.L=1,o.v=di(Ye(u)),o.m=l,o.P=!0,bl(o,null)}function bl(o,u){o.F=Date.now(),ui(o),o.A=Ye(o.v);var l=o.A,f=o.R;Array.isArray(f)||(f=[String(f)]),Ul(l.i,"t",f),o.C=0,l=o.j.J,o.h=new Tl,o.g=rh(o.j,l?u:null,!o.m),0<o.O&&(o.M=new hm(T(o.Y,o,o.g),o.O)),u=o.U,l=o.g,f=o.ca;var A="readystatechange";Array.isArray(A)||(A&&(pl[0]=A.toString()),A=pl);for(var S=0;S<A.length;S++){var k=al(l,A[S],f||u.handleEvent,!1,u.h||u);if(!k)break;u.g[k.key]=k}u=o.H?m(o.H):{},o.m?(o.u||(o.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,u)):(o.u="GET",o.g.ea(o.A,o.u,null,u)),Zn(),pm(o.i,o.u,o.A,o.l,o.R,o.m)}dt.prototype.ca=function(o){o=o.target;let u=this.M;u&&Xe(o)==3?u.j():this.Y(o)},dt.prototype.Y=function(o){try{if(o==this.g)e:{let ye=Xe(this.g);var u=this.g.Ba();let pn=this.g.Z();if(!(3>ye)&&(ye!=3||this.g&&(this.h.h||this.g.oa()||Wl(this.g)))){this.J||ye!=4||u==7||(u==8||0>=pn?Zn(3):Zn(2)),co(this);var l=this.g.Z();this.X=l;t:if(Sl(this)){var f=Wl(this.g);o="";var A=f.length,S=Xe(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ut(this),nr(this);var k="";break t}this.h.i=new c.TextDecoder}for(u=0;u<A;u++)this.h.h=!0,o+=this.h.i.decode(f[u],{stream:!(S&&u==A-1)});f.length=0,this.h.g+=o,this.C=0,k=this.h.g}else k=this.g.oa();if(this.o=l==200,mm(this.i,this.u,this.A,this.l,this.R,ye,l),this.o){if(this.T&&!this.K){t:{if(this.g){var Y,fe=this.g;if((Y=fe.g?fe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(Y)){var H=Y;break t}}H=null}if(l=H)hn(this.i,this.l,l,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,uo(this,l);else{this.o=!1,this.s=3,Te(12),Ut(this),nr(this);break e}}if(this.P){l=!0;let xe;for(;!this.J&&this.C<k.length;)if(xe=ym(this,k),xe==oo){ye==4&&(this.s=4,Te(14),l=!1),hn(this.i,this.l,null,"[Incomplete Response]");break}else if(xe==Al){this.s=4,Te(15),hn(this.i,this.l,k,"[Invalid Chunk]"),l=!1;break}else hn(this.i,this.l,xe,null),uo(this,xe);if(Sl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ye!=4||k.length!=0||this.h.h||(this.s=1,Te(16),l=!1),this.o=this.o&&l,!l)hn(this.i,this.l,k,"[Invalid Chunked Response]"),Ut(this),nr(this);else if(0<k.length&&!this.W){this.W=!0;var _e=this.j;_e.g==this&&_e.ba&&!_e.M&&(_e.j.info("Great, no buffering proxy detected. Bytes received: "+k.length),go(_e),_e.M=!0,Te(11))}}else hn(this.i,this.l,k,null),uo(this,k);ye==4&&Ut(this),this.o&&!this.J&&(ye==4?Zl(this.j,this):(this.o=!1,ui(this)))}else Vm(this.g),l==400&&0<k.indexOf("Unknown SID")?(this.s=3,Te(12)):(this.s=0,Te(13)),Ut(this),nr(this)}}}catch{}finally{}};function Sl(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function ym(o,u){var l=o.C,f=u.indexOf(`
`,l);return f==-1?oo:(l=Number(u.substring(l,f)),isNaN(l)?Al:(f+=1,f+l>u.length?oo:(u=u.slice(f,f+l),o.C=f+l,u)))}dt.prototype.cancel=function(){this.J=!0,Ut(this)};function ui(o){o.S=Date.now()+o.I,Rl(o,o.I)}function Rl(o,u){if(o.B!=null)throw Error("WatchDog timer not null");o.B=er(T(o.ba,o),u)}function co(o){o.B&&(c.clearTimeout(o.B),o.B=null)}dt.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(gm(this.i,this.A),this.L!=2&&(Zn(),Te(17)),Ut(this),this.s=2,nr(this)):Rl(this,this.S-o)};function nr(o){o.j.G==0||o.J||Zl(o.j,o)}function Ut(o){co(o);var u=o.M;u&&typeof u.ma=="function"&&u.ma(),o.M=null,ml(o.U),o.g&&(u=o.g,o.g=null,u.abort(),u.ma())}function uo(o,u){try{var l=o.j;if(l.G!=0&&(l.g==o||lo(l.h,o))){if(!o.K&&lo(l.h,o)&&l.G==3){try{var f=l.Da.g.parse(u)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!l.u){if(l.g)if(l.g.F+3e3<o.F)_i(l),mi(l);else break e;mo(l),Te(18)}}else l.za=A[1],0<l.za-l.T&&37500>A[2]&&l.F&&l.v==0&&!l.C&&(l.C=er(T(l.Za,l),6e3));if(1>=Dl(l.h)&&l.ca){try{l.ca()}catch{}l.ca=void 0}}else qt(l,11)}else if((o.K||l.g==o)&&_i(l),!B(u))for(A=l.Da.g.parse(u),u=0;u<A.length;u++){let H=A[u];if(l.T=H[0],H=H[1],l.G==2)if(H[0]=="c"){l.K=H[1],l.ia=H[2];let _e=H[3];_e!=null&&(l.la=_e,l.j.info("VER="+l.la));let ye=H[4];ye!=null&&(l.Aa=ye,l.j.info("SVER="+l.Aa));let pn=H[5];pn!=null&&typeof pn=="number"&&0<pn&&(f=1.5*pn,l.L=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;let xe=o.g;if(xe){let vi=xe.g?xe.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vi){var S=f.h;S.g||vi.indexOf("spdy")==-1&&vi.indexOf("quic")==-1&&vi.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(ho(S,S.h),S.h=null))}if(f.D){let _o=xe.g?xe.g.getResponseHeader("X-HTTP-Session-Id"):null;_o&&(f.ya=_o,Z(f.I,f.D,_o))}}l.G=3,l.l&&l.l.ua(),l.ba&&(l.R=Date.now()-o.F,l.j.info("Handshake RTT: "+l.R+"ms")),f=l;var k=o;if(f.qa=nh(f,f.J?f.ia:null,f.W),k.K){Nl(f.h,k);var Y=k,fe=f.L;fe&&(Y.I=fe),Y.B&&(co(Y),ui(Y)),f.g=k}else Yl(f);0<l.i.length&&gi(l)}else H[0]!="stop"&&H[0]!="close"||qt(l,7);else l.G==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?qt(l,7):po(l):H[0]!="noop"&&l.l&&l.l.ta(H),l.v=0)}}Zn(4)}catch{}}var vm=class{constructor(o,u){this.g=o,this.map=u}};function Pl(o){this.l=o||10,c.PerformanceNavigationTiming?(o=c.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Cl(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Dl(o){return o.h?1:o.g?o.g.size:0}function lo(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function ho(o,u){o.g?o.g.add(u):o.h=u}function Nl(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}Pl.prototype.cancel=function(){if(this.i=kl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function kl(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let u=o.i;for(let l of o.g.values())u=u.concat(l.D);return u}return O(o.i)}function Im(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(h(o)){for(var u=[],l=o.length,f=0;f<l;f++)u.push(o[f]);return u}u=[],l=0;for(f in o)u[l++]=o[f];return u}function wm(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(h(o)||typeof o=="string"){var u=[];o=o.length;for(var l=0;l<o;l++)u.push(l);return u}u=[],l=0;for(let f in o)u[l++]=f;return u}}}function Ol(o,u){if(o.forEach&&typeof o.forEach=="function")o.forEach(u,void 0);else if(h(o)||typeof o=="string")Array.prototype.forEach.call(o,u,void 0);else for(var l=wm(o),f=Im(o),A=f.length,S=0;S<A;S++)u.call(void 0,f[S],l&&l[S],o)}var xl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Em(o,u){if(o){o=o.split("&");for(var l=0;l<o.length;l++){var f=o[l].indexOf("="),A=null;if(0<=f){var S=o[l].substring(0,f);A=o[l].substring(f+1)}else S=o[l];u(S,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Bt(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Bt){this.h=o.h,li(this,o.j),this.o=o.o,this.g=o.g,hi(this,o.s),this.l=o.l;var u=o.i,l=new sr;l.i=u.i,u.g&&(l.g=new Map(u.g),l.h=u.h),Vl(this,l),this.m=o.m}else o&&(u=String(o).match(xl))?(this.h=!1,li(this,u[1]||"",!0),this.o=rr(u[2]||""),this.g=rr(u[3]||"",!0),hi(this,u[4]),this.l=rr(u[5]||"",!0),Vl(this,u[6]||"",!0),this.m=rr(u[7]||"")):(this.h=!1,this.i=new sr(null,this.h))}Bt.prototype.toString=function(){var o=[],u=this.j;u&&o.push(ir(u,Ll,!0),":");var l=this.g;return(l||u=="file")&&(o.push("//"),(u=this.o)&&o.push(ir(u,Ll,!0),"@"),o.push(encodeURIComponent(String(l)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.s,l!=null&&o.push(":",String(l))),(l=this.l)&&(this.g&&l.charAt(0)!="/"&&o.push("/"),o.push(ir(l,l.charAt(0)=="/"?bm:Am,!0))),(l=this.i.toString())&&o.push("?",l),(l=this.m)&&o.push("#",ir(l,Rm)),o.join("")};function Ye(o){return new Bt(o)}function li(o,u,l){o.j=l?rr(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function hi(o,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);o.s=u}else o.s=null}function Vl(o,u,l){u instanceof sr?(o.i=u,Pm(o.i,o.h)):(l||(u=ir(u,Sm)),o.i=new sr(u,o.h))}function Z(o,u,l){o.i.set(u,l)}function di(o){return Z(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function rr(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function ir(o,u,l){return typeof o=="string"?(o=encodeURI(o).replace(u,Tm),l&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Tm(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Ll=/[#\/\?@]/g,Am=/[#\?:]/g,bm=/[#\?]/g,Sm=/[#\?@]/g,Rm=/#/g;function sr(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function ft(o){o.g||(o.g=new Map,o.h=0,o.i&&Em(o.i,function(u,l){o.add(decodeURIComponent(u.replace(/\+/g," ")),l)}))}n=sr.prototype,n.add=function(o,u){ft(this),this.i=null,o=dn(this,o);var l=this.g.get(o);return l||this.g.set(o,l=[]),l.push(u),this.h+=1,this};function Ml(o,u){ft(o),u=dn(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Fl(o,u){return ft(o),u=dn(o,u),o.g.has(u)}n.forEach=function(o,u){ft(this),this.g.forEach(function(l,f){l.forEach(function(A){o.call(u,A,f,this)},this)},this)},n.na=function(){ft(this);let o=Array.from(this.g.values()),u=Array.from(this.g.keys()),l=[];for(let f=0;f<u.length;f++){let A=o[f];for(let S=0;S<A.length;S++)l.push(u[f])}return l},n.V=function(o){ft(this);let u=[];if(typeof o=="string")Fl(this,o)&&(u=u.concat(this.g.get(dn(this,o))));else{o=Array.from(this.g.values());for(let l=0;l<o.length;l++)u=u.concat(o[l])}return u},n.set=function(o,u){return ft(this),this.i=null,o=dn(this,o),Fl(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},n.get=function(o,u){return o?(o=this.V(o),0<o.length?String(o[0]):u):u};function Ul(o,u,l){Ml(o,u),0<l.length&&(o.i=null,o.g.set(dn(o,u),O(l)),o.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],u=Array.from(this.g.keys());for(var l=0;l<u.length;l++){var f=u[l];let S=encodeURIComponent(String(f)),k=this.V(f);for(f=0;f<k.length;f++){var A=S;k[f]!==""&&(A+="="+encodeURIComponent(String(k[f]))),o.push(A)}}return this.i=o.join("&")};function dn(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function Pm(o,u){u&&!o.j&&(ft(o),o.i=null,o.g.forEach(function(l,f){var A=f.toLowerCase();f!=A&&(Ml(this,f),Ul(this,A,l))},o)),o.j=u}function Cm(o,u){let l=new tr;if(c.Image){let f=new Image;f.onload=R(pt,l,"TestLoadImage: loaded",!0,u,f),f.onerror=R(pt,l,"TestLoadImage: error",!1,u,f),f.onabort=R(pt,l,"TestLoadImage: abort",!1,u,f),f.ontimeout=R(pt,l,"TestLoadImage: timeout",!1,u,f),c.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else u(!1)}function Dm(o,u){let l=new tr,f=new AbortController,A=setTimeout(()=>{f.abort(),pt(l,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?pt(l,"TestPingServer: ok",!0,u):pt(l,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(A),pt(l,"TestPingServer: error",!1,u)})}function pt(o,u,l,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(l)}catch{}}function Nm(){this.g=new fm}function km(o,u,l){let f=l||"";try{Ol(o,function(A,S){let k=A;d(A)&&(k=to(A)),u.push(f+S+"="+encodeURIComponent(k))})}catch(A){throw u.push(f+"type="+encodeURIComponent("_badmap")),A}}function or(o){this.l=o.Ub||null,this.j=o.eb||!1}D(or,no),or.prototype.g=function(){return new fi(this.l,this.j)},or.prototype.i=function(o){return function(){return o}}({});function fi(o,u){ge.call(this),this.D=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(fi,ge),n=fi.prototype,n.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=u,this.readyState=1,cr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(u.body=o),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ar(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,cr(this)),this.g&&(this.readyState=3,cr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Bl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Bl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?ar(this):cr(this),this.readyState==3&&Bl(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,ar(this))},n.Qa=function(o){this.g&&(this.response=o,ar(this))},n.ga=function(){this.g&&ar(this)};function ar(o){o.readyState=4,o.l=null,o.j=null,o.v=null,cr(o)}n.setRequestHeader=function(o,u){this.u.append(o,u)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],u=this.h.entries();for(var l=u.next();!l.done;)l=l.value,o.push(l[0]+": "+l[1]),l=u.next();return o.join(`\r
`)};function cr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(fi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function ql(o){let u="";return G(o,function(l,f){u+=f,u+=":",u+=l,u+=`\r
`}),u}function fo(o,u,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=ql(l),typeof o=="string"?l!=null&&encodeURIComponent(String(l)):Z(o,u,l))}function ne(o){ge.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(ne,ge);var Om=/^https?$/i,xm=["POST","PUT"];n=ne.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,u,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():so.g(),this.v=this.o?gl(this.o):gl(so),this.g.onreadystatechange=T(this.Ea,this);try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(S){jl(this,S);return}if(o=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)l.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),A=c.FormData&&o instanceof c.FormData,!(0<=Array.prototype.indexOf.call(xm,u,void 0))||f||A||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,k]of l)this.g.setRequestHeader(S,k);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gl(this),this.u=!0,this.g.send(o),this.u=!1}catch(S){jl(this,S)}};function jl(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.m=5,$l(o),pi(o)}function $l(o){o.A||(o.A=!0,Ee(o,"complete"),Ee(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ee(this,"complete"),Ee(this,"abort"),pi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),pi(this,!0)),ne.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?zl(this):this.bb())},n.bb=function(){zl(this)};function zl(o){if(o.h&&typeof a<"u"&&(!o.v[1]||Xe(o)!=4||o.Z()!=2)){if(o.u&&Xe(o)==4)dl(o.Ea,0,o);else if(Ee(o,"readystatechange"),Xe(o)==4){o.h=!1;try{let k=o.Z();e:switch(k){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var l;if(!(l=u)){var f;if(f=k===0){var A=String(o.D).match(xl)[1]||null;!A&&c.self&&c.self.location&&(A=c.self.location.protocol.slice(0,-1)),f=!Om.test(A?A.toLowerCase():"")}l=f}if(l)Ee(o,"complete"),Ee(o,"success");else{o.m=6;try{var S=2<Xe(o)?o.g.statusText:""}catch{S=""}o.l=S+" ["+o.Z()+"]",$l(o)}}finally{pi(o)}}}}function pi(o,u){if(o.g){Gl(o);let l=o.g,f=o.v[0]?()=>{}:null;o.g=null,o.v=null,u||Ee(o,"ready");try{l.onreadystatechange=f}catch{}}}function Gl(o){o.I&&(c.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function Xe(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<Xe(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),dm(u)}};function Wl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Vm(o){let u={};o=(o.g&&2<=Xe(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(B(o[f]))continue;var l=E(o[f]);let A=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();let S=u[A]||[];u[A]=S,S.push(l)}w(u,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ur(o,u,l){return l&&l.internalChannelParams&&l.internalChannelParams[o]||u}function Kl(o){this.Aa=0,this.i=[],this.j=new tr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ur("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ur("baseRetryDelayMs",5e3,o),this.cb=ur("retryDelaySeedMs",1e4,o),this.Wa=ur("forwardChannelMaxRetries",2,o),this.wa=ur("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Pl(o&&o.concurrentRequestLimit),this.Da=new Nm,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Kl.prototype,n.la=8,n.G=1,n.connect=function(o,u,l,f){Te(0),this.W=o,this.H=u||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.I=nh(this,null,this.W),gi(this)};function po(o){if(Ql(o),o.G==3){var u=o.U++,l=Ye(o.I);if(Z(l,"SID",o.K),Z(l,"RID",u),Z(l,"TYPE","terminate"),lr(o,l),u=new dt(o,o.j,u),u.L=2,u.v=di(Ye(l)),l=!1,c.navigator&&c.navigator.sendBeacon)try{l=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!l&&c.Image&&(new Image().src=u.v,l=!0),l||(u.g=rh(u.j,null),u.g.ea(u.v)),u.F=Date.now(),ui(u)}th(o)}function mi(o){o.g&&(go(o),o.g.cancel(),o.g=null)}function Ql(o){mi(o),o.u&&(c.clearTimeout(o.u),o.u=null),_i(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&c.clearTimeout(o.s),o.s=null)}function gi(o){if(!Cl(o.h)&&!o.s){o.s=!0;var u=o.Ga;Kn||ol(),Qn||(Kn(),Qn=!0),Ws.add(u,o),o.B=0}}function Lm(o,u){return Dl(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=u.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=er(T(o.Ga,o,u),eh(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let A=new dt(this,this.j,o),S=this.o;if(this.S&&(S?(S=m(S),I(S,this.S)):S=this.S),this.m!==null||this.O||(A.H=S,S=null),this.P)e:{for(var u=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(u+=f,4096<u){u=l;break e}if(u===4096||l===this.i.length-1){u=l+1;break e}}u=1e3}else u=1e3;u=Jl(this,A,u),l=Ye(this.I),Z(l,"RID",o),Z(l,"CVER",22),this.D&&Z(l,"X-HTTP-Session-Id",this.D),lr(this,l),S&&(this.O?u="headers="+encodeURIComponent(String(ql(S)))+"&"+u:this.m&&fo(l,this.m,S)),ho(this.h,A),this.Ua&&Z(l,"TYPE","init"),this.P?(Z(l,"$req",u),Z(l,"SID","null"),A.T=!0,ao(A,l,null)):ao(A,l,u),this.G=2}}else this.G==3&&(o?Hl(this,o):this.i.length==0||Cl(this.h)||Hl(this))};function Hl(o,u){var l;u?l=u.l:l=o.U++;let f=Ye(o.I);Z(f,"SID",o.K),Z(f,"RID",l),Z(f,"AID",o.T),lr(o,f),o.m&&o.o&&fo(f,o.m,o.o),l=new dt(o,o.j,l,o.B+1),o.m===null&&(l.H=o.o),u&&(o.i=u.D.concat(o.i)),u=Jl(o,l,1e3),l.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),ho(o.h,l),ao(l,f,u)}function lr(o,u){o.H&&G(o.H,function(l,f){Z(u,f,l)}),o.l&&Ol({},function(l,f){Z(u,f,l)})}function Jl(o,u,l){l=Math.min(o.i.length,l);var f=o.l?T(o.l.Na,o.l,o):null;e:{var A=o.i;let S=-1;for(;;){let k=["count="+l];S==-1?0<l?(S=A[0].g,k.push("ofs="+S)):S=0:k.push("ofs="+S);let Y=!0;for(let fe=0;fe<l;fe++){let H=A[fe].g,_e=A[fe].map;if(H-=S,0>H)S=Math.max(0,A[fe].g-100),Y=!1;else try{km(_e,k,"req"+H+"_")}catch{f&&f(_e)}}if(Y){f=k.join("&");break e}}}return o=o.i.splice(0,l),u.D=o,f}function Yl(o){if(!o.g&&!o.u){o.Y=1;var u=o.Fa;Kn||ol(),Qn||(Kn(),Qn=!0),Ws.add(u,o),o.v=0}}function mo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=er(T(o.Fa,o),eh(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,Xl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=er(T(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Te(10),mi(this),Xl(this))};function go(o){o.A!=null&&(c.clearTimeout(o.A),o.A=null)}function Xl(o){o.g=new dt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var u=Ye(o.qa);Z(u,"RID","rpc"),Z(u,"SID",o.K),Z(u,"AID",o.T),Z(u,"CI",o.F?"0":"1"),!o.F&&o.ja&&Z(u,"TO",o.ja),Z(u,"TYPE","xmlhttp"),lr(o,u),o.m&&o.o&&fo(u,o.m,o.o),o.L&&(o.g.I=o.L);var l=o.g;o=o.ia,l.L=1,l.v=di(Ye(u)),l.m=null,l.P=!0,bl(l,o)}n.Za=function(){this.C!=null&&(this.C=null,mi(this),mo(this),Te(19))};function _i(o){o.C!=null&&(c.clearTimeout(o.C),o.C=null)}function Zl(o,u){var l=null;if(o.g==u){_i(o),go(o),o.g=null;var f=2}else if(lo(o.h,u))l=u.D,Nl(o.h,u),f=1;else return;if(o.G!=0){if(u.o)if(f==1){l=u.m?u.m.length:0,u=Date.now()-u.F;var A=o.B;f=oi(),Ee(f,new wl(f,l)),gi(o)}else Yl(o);else if(A=u.s,A==3||A==0&&0<u.X||!(f==1&&Lm(o,u)||f==2&&mo(o)))switch(l&&0<l.length&&(u=o.h,u.i=u.i.concat(l)),A){case 1:qt(o,5);break;case 4:qt(o,10);break;case 3:qt(o,6);break;default:qt(o,2)}}}function eh(o,u){let l=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(l*=2),l*u}function qt(o,u){if(o.j.info("Error code "+u),u==2){var l=T(o.fb,o),f=o.Xa;let A=!f;f=new Bt(f||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||li(f,"https"),di(f),A?Cm(f.toString(),l):Dm(f.toString(),l)}else Te(2);o.G=0,o.l&&o.l.sa(u),th(o),Ql(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Te(2)):(this.j.info("Failed to ping google.com"),Te(1))};function th(o){if(o.G=0,o.ka=[],o.l){let u=kl(o.h);(u.length!=0||o.i.length!=0)&&(C(o.ka,u),C(o.ka,o.i),o.h.i.length=0,O(o.i),o.i.length=0),o.l.ra()}}function nh(o,u,l){var f=l instanceof Bt?Ye(l):new Bt(l);if(f.g!="")u&&(f.g=u+"."+f.g),hi(f,f.s);else{var A=c.location;f=A.protocol,u=u?u+"."+A.hostname:A.hostname,A=+A.port;var S=new Bt(null);f&&li(S,f),u&&(S.g=u),A&&hi(S,A),l&&(S.l=l),f=S}return l=o.D,u=o.ya,l&&u&&Z(f,l,u),Z(f,"VER",o.la),lr(o,f),f}function rh(o,u,l){if(u&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Ca&&!o.pa?new ne(new or({eb:l})):new ne(o.pa),u.Ha(o.J),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ih(){}n=ih.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function yi(){}yi.prototype.g=function(o,u){return new Se(o,u)};function Se(o,u){ge.call(this),this.g=new Kl(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(o?o["X-WebChannel-Client-Profile"]=u.va:o={"X-WebChannel-Client-Profile":u.va}),this.g.S=o,(o=u&&u.Sb)&&!B(o)&&(this.g.m=o),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!B(u)&&(this.g.D=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new fn(this)}D(Se,ge),Se.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Se.prototype.close=function(){po(this.g)},Se.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var l={};l.__data__=o,o=l}else this.u&&(l={},l.__data__=to(o),o=l);u.i.push(new vm(u.Ya++,o)),u.G==3&&gi(u)},Se.prototype.N=function(){this.g.l=null,delete this.j,po(this.g),delete this.g,Se.aa.N.call(this)};function sh(o){ro.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(let l in u){o=l;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}D(sh,ro);function oh(){io.call(this),this.status=1}D(oh,io);function fn(o){this.g=o}D(fn,ih),fn.prototype.ua=function(){Ee(this.g,"a")},fn.prototype.ta=function(o){Ee(this.g,new sh(o))},fn.prototype.sa=function(o){Ee(this.g,new oh)},fn.prototype.ra=function(){Ee(this.g,"b")},yi.prototype.createWebChannel=yi.prototype.g,Se.prototype.send=Se.prototype.o,Se.prototype.open=Se.prototype.m,Se.prototype.close=Se.prototype.close,Ja=ot.createWebChannelTransport=function(){return new yi},Ha=ot.getStatEventTarget=function(){return oi()},Qa=ot.Event=Ft,Zi=ot.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ai.NO_ERROR=0,ai.TIMEOUT=8,ai.HTTP_ERROR=6,Nr=ot.ErrorCode=ai,El.COMPLETE="complete",Ka=ot.EventType=El,_l.EventType=Xn,Xn.OPEN="a",Xn.CLOSE="b",Xn.ERROR="c",Xn.MESSAGE="d",ge.prototype.listen=ge.prototype.K,An=ot.WebChannel=_l,Wa=ot.FetchXmlHttpFactory=or,ne.prototype.listenOnce=ne.prototype.L,ne.prototype.getLastError=ne.prototype.Ka,ne.prototype.getLastErrorCode=ne.prototype.Ba,ne.prototype.getStatus=ne.prototype.Z,ne.prototype.getResponseJson=ne.prototype.Oa,ne.prototype.getResponseText=ne.prototype.oa,ne.prototype.send=ne.prototype.ea,ne.prototype.setWithCredentials=ne.prototype.Ha,Ga=ot.XhrIo=ne}).apply(typeof Xi<"u"?Xi:typeof self<"u"?self:typeof window<"u"?window:{});var of="@firebase/firestore";var de=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};de.UNAUTHENTICATED=new de(null),de.GOOGLE_CREDENTIALS=new de("google-credentials-uid"),de.FIRST_PARTY=new de("first-party-uid"),de.MOCK_USER=new de("mock-user");var zn="10.13.1";var en=new Tt("@firebase/firestore");function kr(){return en.logLevel}function L(n,...e){if(en.logLevel<=W.DEBUG){let t=e.map(Vu);en.debug(`Firestore (${zn}): ${n}`,...t)}}function ct(n,...e){if(en.logLevel<=W.ERROR){let t=e.map(Vu);en.error(`Firestore (${zn}): ${n}`,...t)}}function Nn(n,...e){if(en.logLevel<=W.WARN){let t=e.map(Vu);en.warn(`Firestore (${zn}): ${n}`,...t)}}function Vu(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function U(n="Unexpected state"){let e=`FIRESTORE (${zn}) INTERNAL ASSERTION FAILED: `+n;throw ct(e),new Error(e)}function X(n,e){n||U()}function q(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends Pe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ze=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var is=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},tc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(de.UNAUTHENTICATED))}shutdown(){}},nc=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},rc=class{constructor(e){this.t=e,this.currentUser=de.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),s=new ze;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ze,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=s;e.enqueueRetryable(()=>y(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},c=h=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?c(h):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ze)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(X(typeof r.accessToken=="string"),new is(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return X(e===null||typeof e=="string"),new de(e)}},ic=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=de.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},sc=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new ic(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(de.FIRST_PARTY))}shutdown(){}invalidateToken(){}},oc=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ac=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,L("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(X(typeof t.token=="string"),this.R=t.token,new oc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function hI(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var ss=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=hI(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function J(n,e){return n<e?-1:n>e?1:0}function kn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var pe=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var $=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new pe(0,0))}static max(){return new n(new pe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var os=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&U(),r===void 0?r=e.length-t:r>e.length-t&&U(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},te=class n extends os{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},dI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,De=class n extends os{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return dI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else c==="`"?(a=!a,i++):c!=="."||a?(r+=c,i++):(s(),i++)}if(s(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var M=class n{constructor(e){this.path=e}static fromPath(e){return new n(te.fromString(e))}static fromName(e){return new n(te.fromString(e).popFirst(5))}static empty(){return new n(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new te(e.slice()))}};var cc=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};cc.UNKNOWN_ID=-1;function fI(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=$.fromTimestamp(r===1e9?new pe(t+1,0):new pe(t,r));return new tn(i,M.empty(),e)}function pI(n){return new tn(n.readTime,n.key,-1)}var tn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n($.min(),M.empty(),-1)}static max(){return new n($.max(),M.empty(),-1)}};function mI(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:J(n.largestBatchId,e.largestBatchId))}var gI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",uc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Yr(n){return y(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==gI)throw n;L("LocalStore","Unexpectedly lost primary lease")})}var N=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,a=!1;e.forEach(c=>{++i,c.next(()=>{++s,a&&s===i&&t()},h=>r(h))}),a=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,a=new Array(s),c=0;for(let h=0;h<s;h++){let d=h;t(e[d]).next(p=>{a[d]=p,++c,c===s&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function _I(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Xr(n){return n.name==="IndexedDbTransactionError"}var Bf=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Fs(n){return n==null}function Fr(n){return n===0&&1/n==-1/0}function yI(n){return typeof n=="number"&&Number.isInteger(n)&&!Fr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var vI=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],CA=[...vI,"documentOverlays"],II=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],wI=II,EI=[...wI,"indexConfiguration","indexState","indexEntries"];var DA=[...EI,"globals"];function af(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function un(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function qf(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var re=class n{constructor(e,t){this.comparator=e,this.root=t||Ge.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ge.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ge.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pn(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pn(this.root,e,this.comparator,!0)}},Pn=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ge=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}};Ge.EMPTY=null,Ge.RED=!0,Ge.BLACK=!1;Ge.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ge(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ie=class n{constructor(e){this.comparator=e,this.data=new re(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new as(this.data.getIterator())}getIteratorFrom(e){return new as(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},as=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Oe=class n{constructor(e){this.fields=e,e.sort(De.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ie(De.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return kn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var cs=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var we=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new cs("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};we.EMPTY_BYTE_STRING=new we("");var TI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ut(n){if(X(!!n),typeof n=="string"){let e=0,t=TI.exec(n);if(X(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ee(n.seconds),nanos:ee(n.nanos)}}function ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function xt(n){return typeof n=="string"?we.fromBase64String(n):we.fromUint8Array(n)}function Lu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Mu(n){let e=n.mapValue.fields.__previous_value__;return Lu(e)?Mu(e):e}function Ur(n){let e=ut(n.mapValue.fields.__local_write_time__.timestampValue);return new pe(e.seconds,e.nanos)}var lc=class{constructor(e,t,r,i,s,a,c,h,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=h,this.useFetchStreams=d}},us=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var es={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function nn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Lu(n)?4:$f(n)?9007199254740991:jf(n)?10:11:U()}function Qe(n,e){if(n===e)return!0;let t=nn(n);if(t!==nn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ur(n).isEqual(Ur(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=ut(i.timestampValue),c=ut(s.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return xt(i.bytesValue).isEqual(xt(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ee(i.geoPointValue.latitude)===ee(s.geoPointValue.latitude)&&ee(i.geoPointValue.longitude)===ee(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ee(i.integerValue)===ee(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ee(i.doubleValue),c=ee(s.doubleValue);return a===c?Fr(a)===Fr(c):isNaN(a)&&isNaN(c)}return!1}(n,e);case 9:return kn(n.arrayValue.values||[],e.arrayValue.values||[],Qe);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},c=s.mapValue.fields||{};if(af(a)!==af(c))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(c[h]===void 0||!Qe(a[h],c[h])))return!1;return!0}(n,e);default:return U()}}function Br(n,e){return(n.values||[]).find(t=>Qe(t,e))!==void 0}function On(n,e){if(n===e)return 0;let t=nn(n),r=nn(e);if(t!==r)return J(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(n.booleanValue,e.booleanValue);case 2:return function(s,a){let c=ee(s.integerValue||s.doubleValue),h=ee(a.integerValue||a.doubleValue);return c<h?-1:c>h?1:c===h?0:isNaN(c)?isNaN(h)?0:-1:1}(n,e);case 3:return cf(n.timestampValue,e.timestampValue);case 4:return cf(Ur(n),Ur(e));case 5:return J(n.stringValue,e.stringValue);case 6:return function(s,a){let c=xt(s),h=xt(a);return c.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){let c=s.split("/"),h=a.split("/");for(let d=0;d<c.length&&d<h.length;d++){let p=J(c[d],h[d]);if(p!==0)return p}return J(c.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){let c=J(ee(s.latitude),ee(a.latitude));return c!==0?c:J(ee(s.longitude),ee(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return uf(n.arrayValue,e.arrayValue);case 10:return function(s,a){var c,h,d,p;let v=s.fields||{},T=a.fields||{},R=(c=v.value)===null||c===void 0?void 0:c.arrayValue,D=(h=T.value)===null||h===void 0?void 0:h.arrayValue,O=J(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((p=D?.values)===null||p===void 0?void 0:p.length)||0);return O!==0?O:uf(R,D)}(n.mapValue,e.mapValue);case 11:return function(s,a){if(s===es.mapValue&&a===es.mapValue)return 0;if(s===es.mapValue)return 1;if(a===es.mapValue)return-1;let c=s.fields||{},h=Object.keys(c),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let v=0;v<h.length&&v<p.length;++v){let T=J(h[v],p[v]);if(T!==0)return T;let R=On(c[h[v]],d[p[v]]);if(R!==0)return R}return J(h.length,p.length)}(n.mapValue,e.mapValue);default:throw U()}}function cf(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return J(n,e);let t=ut(n),r=ut(e),i=J(t.seconds,r.seconds);return i!==0?i:J(t.nanos,r.nanos)}function uf(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=On(t[i],r[i]);if(s)return s}return J(t.length,r.length)}function xn(n){return hc(n)}function hc(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=ut(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return xt(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return M.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=hc(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of r)s?s=!1:i+=",",i+=`${a}:${hc(t.fields[a])}`;return i+"}"}(n.mapValue):U()}function lf(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function dc(n){return!!n&&"integerValue"in n}function Fu(n){return!!n&&"arrayValue"in n}function hf(n){return!!n&&"nullValue"in n}function df(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ns(n){return!!n&&"mapValue"in n}function jf(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function xr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return un(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=xr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function $f(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Ce=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ns(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xr(t)}setAll(e){let t=De.emptyPath(),r={},i=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=c.popLast()}a?r[c.lastSegment()]=xr(a):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());ns(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Qe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ns(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){un(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(xr(this.value))}};function zf(n){let e=[];return un(n.fields,(t,r)=>{let i=new De([t]);if(ns(r)){let s=zf(r.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new Oe(e)}var Le=class n{constructor(e,t,r,i,s,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=c}static newInvalidDocument(e){return new n(e,0,$.min(),$.min(),$.min(),Ce.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,$.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,$.min(),$.min(),Ce.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,$.min(),$.min(),Ce.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ce.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ce.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Vn=class{constructor(e,t){this.position=e,this.inclusive=t}};function ff(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],a=n.position[i];if(s.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),t.key):r=On(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function pf(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Qe(n.position[t],e.position[t]))return!1;return!0}var Ln=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function AI(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ls=class{},ce=class n extends ls{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new pc(e,t,r):t==="array-contains"?new _c(e,r):t==="in"?new yc(e,r):t==="not-in"?new vc(e,r):t==="array-contains-any"?new Ic(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new mc(e,r):new gc(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(On(t,this.value)):t!==null&&nn(this.value)===nn(t)&&this.matchesComparison(On(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Me=class n extends ls{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return Gf(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Gf(n){return n.op==="and"}function Wf(n){return bI(n)&&Gf(n)}function bI(n){for(let e of n.filters)if(e instanceof Me)return!1;return!0}function fc(n){if(n instanceof ce)return n.field.canonicalString()+n.op.toString()+xn(n.value);if(Wf(n))return n.filters.map(e=>fc(e)).join(",");{let e=n.filters.map(t=>fc(t)).join(",");return`${n.op}(${e})`}}function Kf(n,e){return n instanceof ce?function(r,i){return i instanceof ce&&r.op===i.op&&r.field.isEqual(i.field)&&Qe(r.value,i.value)}(n,e):n instanceof Me?function(r,i){return i instanceof Me&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,c)=>s&&Kf(a,i.filters[c]),!0):!1}(n,e):void U()}function Qf(n){return n instanceof ce?function(t){return`${t.field.canonicalString()} ${t.op} ${xn(t.value)}`}(n):n instanceof Me?function(t){return t.op.toString()+" {"+t.getFilters().map(Qf).join(" ,")+"}"}(n):"Filter"}var pc=class extends ce{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){let t=M.comparator(e.key,this.key);return this.matchesComparison(t)}},mc=class extends ce{constructor(e,t){super(e,"in",t),this.keys=Hf("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},gc=class extends ce{constructor(e,t){super(e,"not-in",t),this.keys=Hf("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Hf(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>M.fromName(r.referenceValue))}var _c=class extends ce{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Fu(t)&&Br(t.arrayValue,this.value)}},yc=class extends ce{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Br(this.value.arrayValue,t)}},vc=class extends ce{constructor(e,t){super(e,"not-in",t)}matches(e){if(Br(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Br(this.value.arrayValue,t)}},Ic=class extends ce{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Fu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Br(this.value.arrayValue,r))}};var wc=class{constructor(e,t=null,r=[],i=[],s=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=c,this.ue=null}};function mf(n,e=null,t=[],r=[],i=null,s=null,a=null){return new wc(n,e,t,r,i,s,a)}function Uu(n){let e=q(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>fc(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Fs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>xn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>xn(r)).join(",")),e.ue=t}return e.ue}function Bu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!AI(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Kf(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!pf(n.startAt,e.startAt)&&pf(n.endAt,e.endAt)}function Ec(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var rn=class{constructor(e,t=null,r=[],i=[],s=null,a="F",c=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=c,this.endAt=h,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function SI(n,e,t,r,i,s,a,c){return new rn(n,e,t,r,i,s,a,c)}function qu(n){return new rn(n)}function gf(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Jf(n){return n.collectionGroup!==null}function Vr(n){let e=q(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new Ie(De.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Ln(s,r))}),t.has(De.keyField().canonicalString())||e.ce.push(new Ln(De.keyField(),r))}return e.ce}function We(n){let e=q(n);return e.le||(e.le=RI(e,Vr(n))),e.le}function RI(n,e){if(n.limitType==="F")return mf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Ln(i.field,s)});let t=n.endAt?new Vn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Vn(n.startAt.position,n.startAt.inclusive):null;return mf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Tc(n,e){let t=n.filters.concat([e]);return new rn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ac(n,e,t){return new rn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Us(n,e){return Bu(We(n),We(e))&&n.limitType===e.limitType}function Yf(n){return`${Uu(We(n))}|lt:${n.limitType}`}function bn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Qf(i)).join(", ")}]`),Fs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>xn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>xn(i)).join(",")),`Target(${r})`}(We(n))}; limitType=${n.limitType})`}function Bs(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):M.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Vr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,c,h){let d=ff(a,c,h);return a.inclusive?d<=0:d<0}(r.startAt,Vr(r),i)||r.endAt&&!function(a,c,h){let d=ff(a,c,h);return a.inclusive?d>=0:d>0}(r.endAt,Vr(r),i))}(n,e)}function PI(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Xf(n){return(e,t)=>{let r=!1;for(let i of Vr(n)){let s=CI(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function CI(n,e,t){let r=n.field.isKeyField()?M.comparator(e.key,t.key):function(s,a,c){let h=a.data.field(s),d=c.data.field(s);return h!==null&&d!==null?On(h,d):U()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U()}}var Vt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){un(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return qf(this.inner)}size(){return this.innerSize}};var DI=new re(M.comparator);function lt(){return DI}var Zf=new re(M.comparator);function Or(...n){let e=Zf;for(let t of n)e=e.insert(t.key,t);return e}function ep(n){let e=Zf;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Yt(){return Lr()}function tp(){return Lr()}function Lr(){return new Vt(n=>n.toString(),(n,e)=>n.isEqual(e))}var NI=new re(M.comparator),kI=new Ie(M.comparator);function K(...n){let e=kI;for(let t of n)e=e.add(t);return e}var OI=new Ie(J);function xI(){return OI}function ju(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Fr(e)?"-0":e}}function np(n){return{integerValue:""+n}}function VI(n,e){return yI(e)?np(e):ju(n,e)}var Mn=class{constructor(){this._=void 0}};function LI(n,e,t){return n instanceof Fn?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Lu(s)&&(s=Mu(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):n instanceof sn?ip(n,e):n instanceof on?sp(n,e):function(i,s){let a=rp(i,s),c=_f(a)+_f(i.Pe);return dc(a)&&dc(i.Pe)?np(c):ju(i.serializer,c)}(n,e)}function MI(n,e,t){return n instanceof sn?ip(n,e):n instanceof on?sp(n,e):t}function rp(n,e){return n instanceof Un?function(r){return dc(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Fn=class extends Mn{},sn=class extends Mn{constructor(e){super(),this.elements=e}};function ip(n,e){let t=op(e);for(let r of n.elements)t.some(i=>Qe(i,r))||t.push(r);return{arrayValue:{values:t}}}var on=class extends Mn{constructor(e){super(),this.elements=e}};function sp(n,e){let t=op(e);for(let r of n.elements)t=t.filter(i=>!Qe(i,r));return{arrayValue:{values:t}}}var Un=class extends Mn{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function _f(n){return ee(n.integerValue||n.doubleValue)}function op(n){return Fu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function FI(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof sn&&i instanceof sn||r instanceof on&&i instanceof on?kn(r.elements,i.elements,Qe):r instanceof Un&&i instanceof Un?Qe(r.Pe,i.Pe):r instanceof Fn&&i instanceof Fn}(n.transform,e.transform)}var bc=class{constructor(e,t){this.version=e,this.transformResults=t}},kt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function rs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Bn=class{};function ap(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new hs(n.key,kt.none()):new an(n.key,n.data,kt.none());{let t=n.data,r=Ce.empty(),i=new Ie(De.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new He(n.key,r,new Oe(i.toArray()),kt.none())}}function UI(n,e,t){n instanceof an?function(i,s,a){let c=i.value.clone(),h=vf(i.fieldTransforms,s,a.transformResults);c.setAll(h),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):n instanceof He?function(i,s,a){if(!rs(i.precondition,s))return void s.convertToUnknownDocument(a.version);let c=vf(i.fieldTransforms,s,a.transformResults),h=s.data;h.setAll(cp(i)),h.setAll(c),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Mr(n,e,t,r){return n instanceof an?function(s,a,c,h){if(!rs(s.precondition,a))return c;let d=s.value.clone(),p=If(s.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof He?function(s,a,c,h){if(!rs(s.precondition,a))return c;let d=If(s.fieldTransforms,h,a),p=a.data;return p.setAll(cp(s)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(v=>v.field))}(n,e,t,r):function(s,a,c){return rs(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(n,e,t)}function BI(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=rp(r.transform,i||null);s!=null&&(t===null&&(t=Ce.empty()),t.set(r.field,s))}return t||null}function yf(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&kn(r,i,(s,a)=>FI(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var an=class extends Bn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},He=class extends Bn{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function cp(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function vf(n,e,t){let r=new Map;X(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],a=s.transform,c=e.data.field(s.field);r.set(s.field,MI(a,c,t[i]))}return r}function If(n,e,t){let r=new Map;for(let i of n){let s=i.transform,a=t.data.field(i.field);r.set(i.field,LI(s,a,e))}return r}var hs=class extends Bn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Sc=class extends Bn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Rc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&UI(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Mr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Mr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=tp();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,c=this.applyToLocalView(a,s.mutatedFields);c=t.has(i.key)?null:c;let h=ap(a,c);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument($.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),K())}isEqual(e){return this.batchId===e.batchId&&kn(this.mutations,e.mutations,(t,r)=>yf(t,r))&&kn(this.baseMutations,e.baseMutations,(t,r)=>yf(t,r))}},Pc=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){X(e.mutations.length===r.length);let i=function(){return NI}(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new n(e,t,r,i)}};var Cc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Dc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var oe,Q;function qI(n){switch(n){default:return U();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function up(n){if(n===void 0)return ct("GRPC error has no .code"),P.UNKNOWN;switch(n){case oe.OK:return P.OK;case oe.CANCELLED:return P.CANCELLED;case oe.UNKNOWN:return P.UNKNOWN;case oe.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case oe.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case oe.INTERNAL:return P.INTERNAL;case oe.UNAVAILABLE:return P.UNAVAILABLE;case oe.UNAUTHENTICATED:return P.UNAUTHENTICATED;case oe.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case oe.NOT_FOUND:return P.NOT_FOUND;case oe.ALREADY_EXISTS:return P.ALREADY_EXISTS;case oe.PERMISSION_DENIED:return P.PERMISSION_DENIED;case oe.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case oe.ABORTED:return P.ABORTED;case oe.OUT_OF_RANGE:return P.OUT_OF_RANGE;case oe.UNIMPLEMENTED:return P.UNIMPLEMENTED;case oe.DATA_LOSS:return P.DATA_LOSS;default:return U()}}(Q=oe||(oe={}))[Q.OK=0]="OK",Q[Q.CANCELLED=1]="CANCELLED",Q[Q.UNKNOWN=2]="UNKNOWN",Q[Q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Q[Q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Q[Q.NOT_FOUND=5]="NOT_FOUND",Q[Q.ALREADY_EXISTS=6]="ALREADY_EXISTS",Q[Q.PERMISSION_DENIED=7]="PERMISSION_DENIED",Q[Q.UNAUTHENTICATED=16]="UNAUTHENTICATED",Q[Q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Q[Q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Q[Q.ABORTED=10]="ABORTED",Q[Q.OUT_OF_RANGE=11]="OUT_OF_RANGE",Q[Q.UNIMPLEMENTED=12]="UNIMPLEMENTED",Q[Q.INTERNAL=13]="INTERNAL",Q[Q.UNAVAILABLE=14]="UNAVAILABLE",Q[Q.DATA_LOSS=15]="DATA_LOSS";var wf=null;function jI(){return new TextEncoder}var $I=new Nt([4294967295,4294967295],0);function Ef(n){let e=jI().encode(n),t=new za;return t.update(e),new Uint8Array(t.digest())}function Tf(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Nt([t,r],0),new Nt([i,s],0)]}var Nc=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Xt(`Invalid padding: ${t}`);if(r<0)throw new Xt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Xt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Xt(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Nt.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(Nt.fromNumber(r)));return i.compare($I)===1&&(i=new Nt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Ef(e),[r,i]=Tf(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(r,i,s);if(!this.de(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,i,t);return r.forEach(c=>a.insert(c)),a}insert(e){if(this.Ie===0)return;let t=Ef(e),[r,i]=Tf(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(r,i,s);this.Ae(a)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Xt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ds=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,qr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n($.min(),i,new re(J),lt(),K())}},qr=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,K(),K(),K())}};var Cn=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},fs=class{constructor(e,t){this.targetId=e,this.me=t}},ps=class{constructor(e,t,r=we.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},ms=class{constructor(){this.fe=0,this.ge=bf(),this.pe=we.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=K(),t=K(),r=K();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:U()}}),new qr(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=bf()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,X(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},kc=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=lt(),this.qe=Af(),this.Qe=new re(J)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Ec(s))if(r===0){let a=new M(s.path);this.Ue(t,a,Le.newNoDocument(a,$.min()))}else X(r===1);else{let a=this.Ye(t);if(a!==r){let c=this.Ze(e),h=c?this.Xe(c,e,a):1;if(h!==0){this.je(t);let d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}wf?.et(function(p,v,T,R,D){var O,C,V,B,z,j;let ie={localCacheCount:p,existenceFilterCount:v.count,databaseId:T.database,projectId:T.projectId},G=v.unchangedNames;return G&&(ie.bloomFilter={applied:D===0,hashCount:(O=G?.hashCount)!==null&&O!==void 0?O:0,bitmapLength:(B=(V=(C=G?.bits)===null||C===void 0?void 0:C.bitmap)===null||V===void 0?void 0:V.length)!==null&&B!==void 0?B:0,padding:(j=(z=G?.bits)===null||z===void 0?void 0:z.padding)!==null&&j!==void 0?j:0,mightContain:w=>{var m;return(m=R?.mightContain(w))!==null&&m!==void 0&&m}}),ie}(a,e.me,this.Le.tt(),c,h))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,a,c;try{a=xt(r).toUint8Array()}catch(h){if(h instanceof cs)return Nn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{c=new Nc(a,i,s)}catch(h){return Nn(h instanceof Xt?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return c.Ie===0?null:c}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let a=this.Le.tt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,a)=>{let c=this.Je(a);if(c){if(s.current&&Ec(c.target)){let h=new M(c.target.path);this.ke.get(h)!==null||this.it(a,h)||this.Ue(a,h,Le.newNoDocument(h,e))}s.be&&(t.set(a,s.ve()),s.Ce())}});let r=K();this.qe.forEach((s,a)=>{let c=!0;a.forEachWhile(h=>{let d=this.Je(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));let i=new ds(e,t,this.Qe,this.ke,r);return this.ke=lt(),this.qe=Af(),this.Qe=new re(J),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new ms,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ie(J),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new ms),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Af(){return new re(M.comparator)}function bf(){return new re(M.comparator)}var zI={asc:"ASCENDING",desc:"DESCENDING"},GI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},WI={and:"AND",or:"OR"},Oc=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function xc(n,e){return n.useProto3Json||Fs(e)?e:{value:e}}function gs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function lp(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function KI(n,e){return gs(n,e.toTimestamp())}function Ke(n){return X(!!n),$.fromTimestamp(function(t){let r=ut(t);return new pe(r.seconds,r.nanos)}(n))}function $u(n,e){return Vc(n,e).canonicalString()}function Vc(n,e){let t=function(i){return new te(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function hp(n){let e=te.fromString(n);return X(gp(e)),e}function Lc(n,e){return $u(n.databaseId,e.path)}function Ya(n,e){let t=hp(e);if(t.get(1)!==n.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(fp(t))}function dp(n,e){return $u(n.databaseId,e)}function QI(n){let e=hp(n);return e.length===4?te.emptyPath():fp(e)}function Mc(n){return new te(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fp(n){return X(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Sf(n,e,t){return{name:Lc(n,e),fields:t.value.mapValue.fields}}function HI(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:U()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(d,p){return d.useProto3Json?(X(p===void 0||typeof p=="string"),we.fromBase64String(p||"")):(X(p===void 0||p instanceof Buffer||p instanceof Uint8Array),we.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(d){let p=d.code===void 0?P.UNKNOWN:up(d.code);return new x(p,d.message||"")}(a);t=new ps(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ya(n,r.document.name),s=Ke(r.document.updateTime),a=r.document.createTime?Ke(r.document.createTime):$.min(),c=new Ce({mapValue:{fields:r.document.fields}}),h=Le.newFoundDocument(i,s,a,c),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Cn(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Ya(n,r.document),s=r.readTime?Ke(r.readTime):$.min(),a=Le.newNoDocument(i,s),c=r.removedTargetIds||[];t=new Cn([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Ya(n,r.document),s=r.removedTargetIds||[];t=new Cn([],s,i,null)}else{if(!("filter"in e))return U();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,a=new Dc(i,s),c=r.targetId;t=new fs(c,a)}}return t}function JI(n,e){let t;if(e instanceof an)t={update:Sf(n,e.key,e.value)};else if(e instanceof hs)t={delete:Lc(n,e.key)};else if(e instanceof He)t={update:Sf(n,e.key,e.data),updateMask:sw(e.fieldMask)};else{if(!(e instanceof Sc))return U();t={verify:Lc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){let c=a.transform;if(c instanceof Fn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof sn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof on)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Un)return{fieldPath:a.field.canonicalString(),increment:c.Pe};throw U()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:KI(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U()}(n,e.precondition)),t}function YI(n,e){return n&&n.length>0?(X(e!==void 0),n.map(t=>function(i,s){let a=i.updateTime?Ke(i.updateTime):Ke(s);return a.isEqual($.min())&&(a=Ke(s)),new bc(a,i.transformResults||[])}(t,e))):[]}function XI(n,e){return{documents:[dp(n,e.path)]}}function ZI(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=dp(n,i);let s=function(d){if(d.length!==0)return mp(Me.create(d,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(p=>function(T){return{field:Sn(T.field),direction:nw(T.dir)}}(p))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let c=xc(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:i}}function ew(n){let e=QI(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){X(r===1);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let s=[];t.where&&(s=function(v){let T=pp(v);return T instanceof Me&&Wf(T)?T.getFilters():[T]}(t.where));let a=[];t.orderBy&&(a=function(v){return v.map(T=>function(D){return new Ln(Rn(D.field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(D.direction))}(T))}(t.orderBy));let c=null;t.limit&&(c=function(v){let T;return T=typeof v=="object"?v.value:v,Fs(T)?null:T}(t.limit));let h=null;t.startAt&&(h=function(v){let T=!!v.before,R=v.values||[];return new Vn(R,T)}(t.startAt));let d=null;return t.endAt&&(d=function(v){let T=!v.before,R=v.values||[];return new Vn(R,T)}(t.endAt)),SI(e,i,a,s,c,"F",h,d)}function tw(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function pp(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Rn(t.unaryFilter.field);return ce.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Rn(t.unaryFilter.field);return ce.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Rn(t.unaryFilter.field);return ce.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Rn(t.unaryFilter.field);return ce.create(a,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):n.fieldFilter!==void 0?function(t){return ce.create(Rn(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Me.create(t.compositeFilter.filters.map(r=>pp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}}(t.compositeFilter.op))}(n):U()}function nw(n){return zI[n]}function rw(n){return GI[n]}function iw(n){return WI[n]}function Sn(n){return{fieldPath:n.canonicalString()}}function Rn(n){return De.fromServerFormat(n.fieldPath)}function mp(n){return n instanceof ce?function(t){if(t.op==="=="){if(df(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NAN"}};if(hf(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(df(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NOT_NAN"}};if(hf(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Sn(t.field),op:rw(t.op),value:t.value}}}(n):n instanceof Me?function(t){let r=t.getFilters().map(i=>mp(i));return r.length===1?r[0]:{compositeFilter:{op:iw(t.op),filters:r}}}(n):U()}function sw(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function gp(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var jr=class n{constructor(e,t,r,i,s=$.min(),a=$.min(),c=we.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Fc=class{constructor(e){this.ct=e}};function ow(n){let e=ew({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ac(e,e.limit,"L"):e}var _s=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ee(e.integerValue));else if("doubleValue"in e){let r=ee(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Fr(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ut(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(xt(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?$f(e)?this.dt(t,Number.MAX_SAFE_INTEGER):jf(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):U()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let a="value",c=((i=(r=s[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(ee(c)),this.Vt(a,t),this.Tt(s[a],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),M.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};_s.vt=new _s;var Uc=class{constructor(){this.un=new Bc}addToCollectionParentIndex(e,t){return this.un.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(tn.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(tn.min())}updateCollectionGroup(e,t,r){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}},Bc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ie(te.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ie(te.comparator)).toArray()}};var kA=new Uint8Array(0);var $e=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};$e.DEFAULT_COLLECTION_PERCENTILE=10,$e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$e.DEFAULT=new $e(41943040,$e.DEFAULT_COLLECTION_PERCENTILE,$e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$e.DISABLED=new $e(-1,0,0);var $r=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var qc=class{constructor(){this.changes=new Vt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Le.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?N.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var jc=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var $c=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Mr(r.mutation,i,Oe.empty(),pe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,K()).next(()=>r))}getLocalViewOfDocuments(e,t,r=K()){let i=Yt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=Or();return s.forEach((c,h)=>{a=a.insert(c,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Yt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,K()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,r,i){let s=lt(),a=Lr(),c=function(){return Lr()}();return t.forEach((h,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof He)?s=s.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Mr(p.mutation,d,p.mutation.getFieldMask(),pe.now())):a.set(d.key,Oe.empty())}),this.recalculateAndSaveOverlays(e,s).next(h=>(h.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>{var v;return c.set(d,new jc(p,(v=a.get(d))!==null&&v!==void 0?v:null))}),c))}recalculateAndSaveOverlays(e,t){let r=Lr(),i=new re((a,c)=>a-c),s=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let c of a)c.keys().forEach(h=>{let d=t.get(h);if(d===null)return;let p=r.get(h)||Oe.empty();p=c.applyToLocalView(d,p),r.set(h,p);let v=(i.get(c.batchId)||K()).add(h);i=i.insert(c.batchId,v)})}).next(()=>{let a=[],c=i.getReverseIterator();for(;c.hasNext();){let h=c.getNext(),d=h.key,p=h.value,v=tp();p.forEach(T=>{if(!s.has(T)){let R=ap(t.get(T),r.get(T));R!==null&&v.set(T,R),s=s.add(T)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,v))}return N.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Jf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):N.resolve(Yt()),c=-1,h=s;return a.next(d=>N.forEach(d,(p,v)=>(c<v.largestBatchId&&(c=v.largestBatchId),s.get(p)?N.resolve():this.remoteDocumentCache.getEntry(e,p).next(T=>{h=h.insert(p,T)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,h,d,K())).next(p=>({batchId:c,changes:ep(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=Or();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,a=Or();return this.indexManager.getCollectionParents(e,s).next(c=>N.forEach(c,h=>{let d=function(v,T){return new rn(T,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)}(t,h.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((v,T)=>{a=a.insert(v,T)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((h,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,Le.newInvalidDocument(p)))});let c=Or();return a.forEach((h,d)=>{let p=s.get(h);p!==void 0&&Mr(p.mutation,d,Oe.empty(),pe.now()),Bs(t,d)&&(c=c.insert(h,d))}),c})}};var zc=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return N.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ke(i.createTime)}}(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:ow(i.bundledQuery),readTime:Ke(i.readTime)}}(t)),N.resolve()}};var Gc=class{constructor(){this.overlays=new re(M.comparator),this.Ir=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Yt();return N.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),N.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),N.resolve()}getOverlaysForCollection(e,t,r){let i=Yt(),s=t.length+1,a=new M(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){let h=c.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&h.largestBatchId>r&&i.set(h.getKey(),h)}return N.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new re((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=s.get(d.largestBatchId);p===null&&(p=Yt(),s=s.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let c=Yt(),h=s.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,p)=>c.set(d,p)),!(c.size()>=i)););return N.resolve(c)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Cc(t,r));let s=this.Ir.get(t);s===void 0&&(s=K(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var Wc=class{constructor(){this.sessionToken=we.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}};var zr=class{constructor(){this.Tr=new Ie(ae.Er),this.dr=new Ie(ae.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new ae(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new ae(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new M(new te([])),r=new ae(t,e),i=new ae(t,e+1),s=[];return this.dr.forEachInRange([r,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new M(new te([])),r=new ae(t,e),i=new ae(t,e+1),s=K();return this.dr.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new ae(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ae=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return M.comparator(e.key,t.key)||J(e.wr,t.wr)}static Ar(e,t){return J(e.wr,t.wr)||M.comparator(e.key,t.key)}};var Kc=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ie(ae.Er)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Rc(s,t,r,i);this.mutationQueue.push(a);for(let c of i)this.br=this.br.add(new ae(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return N.resolve(a)}lookupMutationBatch(e,t){return N.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return N.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ae(t,0),i=new ae(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],a=>{let c=this.Dr(a.wr);s.push(c)}),N.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ie(J);return t.forEach(i=>{let s=new ae(i,0),a=new ae(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],c=>{r=r.add(c.wr)})}),N.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;M.isDocumentKey(s)||(s=s.child(""));let a=new ae(new M(s),0),c=new Ie(J);return this.br.forEachWhile(h=>{let d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(c=c.add(h.wr)),!0)},a),N.resolve(this.Cr(c))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){X(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return N.forEach(t.mutations,i=>{let s=new ae(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new ae(t,0),i=this.br.firstAfterOrEqual(r);return N.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Qc=class{constructor(e){this.Mr=e,this.docs=function(){return new re(M.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return N.resolve(r?r.document.mutableCopy():Le.newInvalidDocument(t))}getEntries(e,t){let r=lt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Le.newInvalidDocument(i))}),N.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=lt(),a=t.path,c=new M(a.child("")),h=this.docs.getIteratorFrom(c);for(;h.hasNext();){let{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||mI(pI(p),r)<=0||(i.has(p.key)||Bs(t,p))&&(s=s.insert(p.key,p.mutableCopy()))}return N.resolve(s)}getAllFromCollectionGroup(e,t,r,i){U()}Or(e,t){return N.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Hc(this)}getSize(e){return N.resolve(this.size)}},Hc=class extends qc{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),N.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Jc=class{constructor(e){this.persistence=e,this.Nr=new Vt(t=>Uu(t),Bu),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.Lr=0,this.Br=new zr,this.targetCount=0,this.kr=$r.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),N.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new $r(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.Kn(t),N.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),N.waitFor(s).next(()=>i)}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return N.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),N.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),N.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),N.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return N.resolve(r)}containsKey(e,t){return N.resolve(this.Br.containsKey(t))}};var Yc=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Bf(0),this.Kr=!1,this.Kr=!0,this.$r=new Wc,this.referenceDelegate=e(this),this.Ur=new Jc(this),this.indexManager=new Uc,this.remoteDocumentCache=function(i){return new Qc(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Fc(t),this.Gr=new zc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Gc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new Kc(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){L("MemoryPersistence","Starting transaction:",e);let i=new Xc(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return N.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},Xc=class extends uc{constructor(e){super(),this.currentSequenceNumber=e}},Zc=class n{constructor(e){this.persistence=e,this.Jr=new zr,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw U()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),N.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),N.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.Xr,r=>{let i=M.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,$.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return N.or([()=>N.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var eu=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=K(),i=K();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var tu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var nu=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return zh()?8:_I(le())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new tu;return this.Xi(e,t,a).next(c=>{if(s.result=c,this.zi)return this.es(e,t,a,c.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(kr()<=W.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",bn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),N.resolve()):(kr()<=W.DEBUG&&L("QueryEngine","Query:",bn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(kr()<=W.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",bn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,We(t))):N.resolve())}Yi(e,t){if(gf(t))return N.resolve(null);let r=We(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Ac(t,null,"F"),r=We(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let a=K(...s);return this.Ji.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,r).next(h=>{let d=this.ts(t,c);return this.ns(t,d,a,h.readTime)?this.Yi(e,Ac(t,null,"F")):this.rs(e,d,t,h)}))})))}Zi(e,t,r,i){return gf(t)||i.isEqual($.min())?N.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let a=this.ts(t,s);return this.ns(t,a,r,i)?N.resolve(null):(kr()<=W.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),bn(t)),this.rs(e,a,t,fI(i,-1)).next(c=>c))})}ts(e,t){let r=new Ie(Xf(e));return t.forEach((i,s)=>{Bs(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return kr()<=W.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",bn(t)),this.Ji.getDocumentsMatchingQuery(e,t,tn.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var ru=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new re(J),this._s=new Vt(s=>Uu(s),Bu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new $c(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function aw(n,e,t,r){return new ru(n,e,t,r)}function _p(n,e){return y(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let a=[],c=[],h=K();for(let d of i){a.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}for(let d of s){c.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:c}))})})})}function cw(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,h,d,p){let v=d.batch,T=v.keys(),R=N.resolve();return T.forEach(D=>{R=R.next(()=>p.getEntry(h,D)).next(O=>{let C=d.docVersions.get(D);X(C!==null),O.version.compareTo(C)<0&&(v.applyToRemoteDocument(O,d),O.isValidDocument()&&(O.setReadTime(d.commitVersion),p.addEntry(O)))})}),R.next(()=>c.mutationQueue.removeMutationBatch(h,v))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let h=K();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(h=h.add(c.batch.mutations[d].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function yp(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function uw(n,e){let t=q(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let c=[];e.targetChanges.forEach((p,v)=>{let T=i.get(v);if(!T)return;c.push(t.Ur.removeMatchingKeys(s,p.removedDocuments,v).next(()=>t.Ur.addMatchingKeys(s,p.addedDocuments,v)));let R=T.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(v)!==null?R=R.withResumeToken(we.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(v,R),function(O,C,V){return O.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=3e8?!0:V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0}(T,R,p)&&c.push(t.Ur.updateTargetData(s,R))});let h=lt(),d=K();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,p))}),c.push(lw(s,a,e.documentUpdates).next(p=>{h=p.Ps,d=p.Is})),!r.isEqual($.min())){let p=t.Ur.getLastRemoteSnapshotVersion(s).next(v=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(p)}return N.waitFor(c).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,h,d)).next(()=>h)}).then(s=>(t.os=i,s))}function lw(n,e,t){let r=K(),i=K();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=lt();return t.forEach((c,h)=>{let d=s.get(c);h.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(c)),h.isNoDocument()&&h.version.isEqual($.min())?(e.removeEntry(c,h.readTime),a=a.insert(c,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(c,h)):L("LocalStore","Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",h.version)}),{Ps:a,Is:i}})}function hw(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function dw(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,N.resolve(i)):t.Ur.allocateTargetId(r).next(a=>(i=new jr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function iu(n,e,t){return y(this,null,function*(){let r=q(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Xr(a))throw a;L("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function Rf(n,e,t){let r=q(n),i=$.min(),s=K();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,d,p){let v=q(h),T=v._s.get(p);return T!==void 0?N.resolve(v.os.get(T)):v.Ur.getTargetData(d,p)}(r,a,We(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,c.targetId).next(h=>{s=h})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,t?i:$.min(),t?s:K())).next(c=>(fw(r,PI(e),c),{documents:c,Ts:s})))}function fw(n,e,t){let r=n.us.get(e)||$.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}var ys=class{constructor(){this.activeTargetIds=xI()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var su=class{constructor(){this.so=new ys,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new ys,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var ou=class{_o(e){}shutdown(){}};var vs=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){L("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){L("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ts=null;function Xa(){return ts===null?ts=function(){return 268435456+Math.round(2147483648*Math.random())}():ts++,"0x"+ts.toString(16)}var pw={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var au=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var ve="WebChannelConnection",cu=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,a){let c=Xa(),h=this.xo(t,r.toUriEncodedString());L("RestConnection",`Sending RPC '${t}' ${c}:`,h,i);let d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,s,a),this.No(t,h,d,i).then(p=>(L("RestConnection",`Received RPC '${t}' ${c}: `,p),p),p=>{throw Nn("RestConnection",`RPC '${t}' ${c} failed with error: `,p,"url: ",h,"request:",i),p})}Lo(t,r,i,s,a,c){return this.Mo(t,r,i,s,a)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+zn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}xo(t,r){let i=pw[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=Xa();return new Promise((a,c)=>{let h=new Ga;h.setWithCredentials(!0),h.listenOnce(Ka.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Nr.NO_ERROR:let p=h.getResponseJson();L(ve,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(p)),a(p);break;case Nr.TIMEOUT:L(ve,`RPC '${e}' ${s} timed out`),c(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case Nr.HTTP_ERROR:let v=h.getStatus();if(L(ve,`RPC '${e}' ${s} failed with status:`,v,"response text:",h.getResponseText()),v>0){let T=h.getResponseJson();Array.isArray(T)&&(T=T[0]);let R=T?.error;if(R&&R.status&&R.message){let D=function(C){let V=C.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(V)>=0?V:P.UNKNOWN}(R.status);c(new x(D,R.message))}else c(new x(P.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new x(P.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{L(ve,`RPC '${e}' ${s} completed.`)}});let d=JSON.stringify(i);L(ve,`RPC '${e}' ${s} sending request:`,i),h.send(t,"POST",d,r,15)})}Bo(e,t,r){let i=Xa(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ja(),c=Ha(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.xmlHttpFactory=new Wa({})),this.Oo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;let p=s.join("");L(ve,`Creating RPC '${e}' stream ${i}: ${p}`,h);let v=a.createWebChannel(p,h),T=!1,R=!1,D=new au({Io:C=>{R?L(ve,`Not sending because RPC '${e}' stream ${i} is closed:`,C):(T||(L(ve,`Opening RPC '${e}' stream ${i} transport.`),v.open(),T=!0),L(ve,`RPC '${e}' stream ${i} sending:`,C),v.send(C))},To:()=>v.close()}),O=(C,V,B)=>{C.listen(V,z=>{try{B(z)}catch(j){setTimeout(()=>{throw j},0)}})};return O(v,An.EventType.OPEN,()=>{R||(L(ve,`RPC '${e}' stream ${i} transport opened.`),D.yo())}),O(v,An.EventType.CLOSE,()=>{R||(R=!0,L(ve,`RPC '${e}' stream ${i} transport closed`),D.So())}),O(v,An.EventType.ERROR,C=>{R||(R=!0,Nn(ve,`RPC '${e}' stream ${i} transport errored:`,C),D.So(new x(P.UNAVAILABLE,"The operation could not be completed")))}),O(v,An.EventType.MESSAGE,C=>{var V;if(!R){let B=C.data[0];X(!!B);let z=B,j=z.error||((V=z[0])===null||V===void 0?void 0:V.error);if(j){L(ve,`RPC '${e}' stream ${i} received error:`,j);let ie=j.status,G=function(_){let I=oe[_];if(I!==void 0)return up(I)}(ie),w=j.message;G===void 0&&(G=P.INTERNAL,w="Unknown error status: "+ie+" with message "+j.message),R=!0,D.So(new x(G,w)),v.close()}else L(ve,`RPC '${e}' stream ${i} received:`,B),D.bo(B)}}),O(c,Qa.STAT_EVENT,C=>{C.stat===Zi.PROXY?L(ve,`RPC '${e}' stream ${i} detected buffering proxy`):C.stat===Zi.NOPROXY&&L(ve,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{D.wo()},0),D}};function Za(){return typeof document<"u"?document:null}function qs(n){return new Oc(n,!0)}var Is=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&L("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var ws=class{constructor(e,t,r,i,s,a,c,h){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=h,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Is(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return y(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return y(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return y(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(ct(t.toString()),ct("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new x(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>y(this,null,function*(){this.state=0,this.start()}))}I_(e){return L("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(L("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},uu=class extends ws{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=HI(this.serializer,e),r=function(s){if(!("targetChange"in s))return $.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?$.min():a.readTime?Ke(a.readTime):$.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=Mc(this.serializer),t.addTarget=function(s,a){let c,h=a.target;if(c=Ec(h)?{documents:XI(s,h)}:{query:ZI(s,h)._t},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=lp(s,a.resumeToken);let d=xc(s,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo($.min())>0){c.readTime=gs(s,a.snapshotVersion.toTimestamp());let d=xc(s,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,e);let r=tw(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=Mc(this.serializer),t.removeTarget=e,this.a_(t)}},lu=class extends ws{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return X(!!e.streamToken),this.lastStreamToken=e.streamToken,X(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){X(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=YI(e.writeResults,e.commitTime),r=Ke(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=Mc(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>JI(this.serializer,r))};this.a_(t)}};var hu=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(e,Vc(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(P.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Lo(e,Vc(t,r),i,a,c,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},du=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ct(t),this.D_=!1):L("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var fu=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(a=>{r.enqueueAndForget(()=>y(this,null,function*(){ln(this)&&(L("RemoteStore","Restarting streams for network reachability change."),yield function(h){return y(this,null,function*(){let d=q(h);d.L_.add(4),yield Zr(d),d.q_.set("Unknown"),d.L_.delete(4),yield js(d)})}(this))}))}),this.q_=new du(r,i)}};function js(n){return y(this,null,function*(){if(ln(n))for(let e of n.B_)yield e(!0)})}function Zr(n){return y(this,null,function*(){for(let e of n.B_)yield e(!1)})}function vp(n,e){let t=q(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Ku(t)?Wu(t):Gn(t).r_()&&Gu(t,e))}function zu(n,e){let t=q(n),r=Gn(t);t.N_.delete(e),r.r_()&&Ip(t,e),t.N_.size===0&&(r.r_()?r.o_():ln(t)&&t.q_.set("Unknown"))}function Gu(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Gn(n).A_(e)}function Ip(n,e){n.Q_.xe(e),Gn(n).R_(e)}function Wu(n){n.Q_=new kc({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Gn(n).start(),n.q_.v_()}function Ku(n){return ln(n)&&!Gn(n).n_()&&n.N_.size>0}function ln(n){return q(n).L_.size===0}function wp(n){n.Q_=void 0}function mw(n){return y(this,null,function*(){n.q_.set("Online")})}function gw(n){return y(this,null,function*(){n.N_.forEach((e,t)=>{Gu(n,e)})})}function _w(n,e){return y(this,null,function*(){wp(n),Ku(n)?(n.q_.M_(e),Wu(n)):n.q_.set("Unknown")})}function yw(n,e,t){return y(this,null,function*(){if(n.q_.set("Online"),e instanceof ps&&e.state===2&&e.cause)try{yield function(i,s){return y(this,null,function*(){let a=s.cause;for(let c of s.targetIds)i.N_.has(c)&&(yield i.remoteSyncer.rejectListen(c,a),i.N_.delete(c),i.Q_.removeTarget(c))})}(n,e)}catch(r){L("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Es(n,r)}else if(e instanceof Cn?n.Q_.Ke(e):e instanceof fs?n.Q_.He(e):n.Q_.We(e),!t.isEqual($.min()))try{let r=yield yp(n.localStore);t.compareTo(r)>=0&&(yield function(s,a){let c=s.Q_.rt(a);return c.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){let p=s.N_.get(d);p&&s.N_.set(d,p.withResumeToken(h.resumeToken,a))}}),c.targetMismatches.forEach((h,d)=>{let p=s.N_.get(h);if(!p)return;s.N_.set(h,p.withResumeToken(we.EMPTY_BYTE_STRING,p.snapshotVersion)),Ip(s,h);let v=new jr(p.target,h,d,p.sequenceNumber);Gu(s,v)}),s.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(r){L("RemoteStore","Failed to raise snapshot:",r),yield Es(n,r)}})}function Es(n,e,t){return y(this,null,function*(){if(!Xr(e))throw e;n.L_.add(1),yield Zr(n),n.q_.set("Offline"),t||(t=()=>yp(n.localStore)),n.asyncQueue.enqueueRetryable(()=>y(this,null,function*(){L("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield js(n)}))})}function Ep(n,e){return e().catch(t=>Es(n,t,e))}function $s(n){return y(this,null,function*(){let e=q(n),t=Lt(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;vw(e);)try{let i=yield hw(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,Iw(e,i)}catch(i){yield Es(e,i)}Tp(e)&&Ap(e)})}function vw(n){return ln(n)&&n.O_.length<10}function Iw(n,e){n.O_.push(e);let t=Lt(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Tp(n){return ln(n)&&!Lt(n).n_()&&n.O_.length>0}function Ap(n){Lt(n).start()}function ww(n){return y(this,null,function*(){Lt(n).p_()})}function Ew(n){return y(this,null,function*(){let e=Lt(n);for(let t of n.O_)e.m_(t.mutations)})}function Tw(n,e,t){return y(this,null,function*(){let r=n.O_.shift(),i=Pc.from(r,e,t);yield Ep(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield $s(n)})}function Aw(n,e){return y(this,null,function*(){e&&Lt(n).V_&&(yield function(r,i){return y(this,null,function*(){if(function(a){return qI(a)&&a!==P.ABORTED}(i.code)){let s=r.O_.shift();Lt(r).s_(),yield Ep(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield $s(r)}})}(n,e)),Tp(n)&&Ap(n)})}function Pf(n,e){return y(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),L("RemoteStore","RemoteStore received new credentials");let r=ln(t);t.L_.add(3),yield Zr(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield js(t)})}function bw(n,e){return y(this,null,function*(){let t=q(n);e?(t.L_.delete(2),yield js(t)):e||(t.L_.add(2),yield Zr(t),t.q_.set("Unknown"))})}function Gn(n){return n.K_||(n.K_=function(t,r,i){let s=q(t);return s.w_(),new uu(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:mw.bind(null,n),Ro:gw.bind(null,n),mo:_w.bind(null,n),d_:yw.bind(null,n)}),n.B_.push(e=>y(this,null,function*(){e?(n.K_.s_(),Ku(n)?Wu(n):n.q_.set("Unknown")):(yield n.K_.stop(),wp(n))}))),n.K_}function Lt(n){return n.U_||(n.U_=function(t,r,i){let s=q(t);return s.w_(),new lu(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:ww.bind(null,n),mo:Aw.bind(null,n),f_:Ew.bind(null,n),g_:Tw.bind(null,n)}),n.B_.push(e=>y(this,null,function*(){e?(n.U_.s_(),yield $s(n)):(yield n.U_.stop(),n.O_.length>0&&(L("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var pu=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ze,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let a=Date.now()+r,c=new n(e,t,a,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Qu(n,e){if(ct("AsyncQueue",`${e}: ${n}`),Xr(n))return new x(P.UNAVAILABLE,`${e}: ${n}`);throw n}var Ts=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||M.comparator(t.key,r.key):(t,r)=>M.comparator(t.key,r.key),this.keyedMap=Or(),this.sortedSet=new re(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var As=class{constructor(){this.W_=new re(M.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):U():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},qn=class n{constructor(e,t,r,i,s,a,c,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,s){let a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new n(e,t,Ts.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Us(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var mu=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},gu=class{constructor(){this.queries=Cf(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=q(t),s=i.queries;i.queries=Cf(),s.forEach((a,c)=>{for(let h of c.j_)h.onError(r)})})(this,new x(P.ABORTED,"Firestore shutting down"))}};function Cf(){return new Vt(n=>Yf(n),Us)}function bp(n,e){return y(this,null,function*(){let t=q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new mu,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let c=Qu(a,`Initialization of query '${bn(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&Hu(t)})}function Sp(n,e){return y(this,null,function*(){let t=q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let a=s.j_.indexOf(e);a>=0&&(s.j_.splice(a,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function Sw(n,e){let t=q(n),r=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let c of a.j_)c.X_(i)&&(r=!0);a.z_=i}}r&&Hu(t)}function Rw(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function Hu(n){n.Y_.forEach(e=>{e.next()})}var _u,Df;(Df=_u||(_u={})).ea="default",Df.Cache="cache";var bs=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new qn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=qn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==_u.Cache}};var Ss=class{constructor(e){this.key=e}},Rs=class{constructor(e){this.key=e}},yu=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=K(),this.mutatedKeys=K(),this.Aa=Xf(e),this.Ra=new Ts(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new As,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,a=i,c=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,v)=>{let T=i.get(p),R=Bs(this.query,v)?v:null,D=!!T&&this.mutatedKeys.has(T.key),O=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),C=!1;T&&R?T.data.isEqual(R.data)?D!==O&&(r.track({type:3,doc:R}),C=!0):this.ga(T,R)||(r.track({type:2,doc:R}),C=!0,(h&&this.Aa(R,h)>0||d&&this.Aa(R,d)<0)&&(c=!0)):!T&&R?(r.track({type:0,doc:R}),C=!0):T&&!R&&(r.track({type:1,doc:T}),C=!0,(h||d)&&(c=!0)),C&&(R?(a=a.add(R),s=O?s.add(p):s.delete(p)):(a=a.delete(p),s=s.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),s=s.delete(p.key),r.track({type:1,doc:p})}return{Ra:a,fa:r,ns:c,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let a=e.fa.G_();a.sort((p,v)=>function(R,D){let O=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return O(R)-O(D)}(p.type,v.type)||this.Aa(p.doc,v.doc)),this.pa(r),i=i!=null&&i;let c=t&&!i?this.ya():[],h=this.da.size===0&&this.current&&!i?1:0,d=h!==this.Ea;return this.Ea=h,a.length!==0||d?{snapshot:new qn(this.query,e.Ra,s,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new As,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=K(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Rs(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Ss(r))}),t}ba(e){this.Ta=e.Ts,this.da=K();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return qn.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},vu=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Iu=class{constructor(e){this.key=e,this.va=!1}},wu=class{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Vt(c=>Yf(c),Us),this.Ma=new Map,this.xa=new Set,this.Oa=new re(M.comparator),this.Na=new Map,this.La=new zr,this.Ba={},this.ka=new Map,this.qa=$r.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function Pw(n,e,t=!0){return y(this,null,function*(){let r=kp(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Rp(r,e,t,!0),i})}function Cw(n,e){return y(this,null,function*(){let t=kp(n);yield Rp(t,e,!0,!1)})}function Rp(n,e,t,r){return y(this,null,function*(){let i=yield dw(n.localStore,We(e)),s=i.targetId,a=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",c;return r&&(c=yield Dw(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&vp(n.remoteStore,i),c})}function Dw(n,e,t,r,i){return y(this,null,function*(){n.Ka=(v,T,R)=>function(O,C,V,B){return y(this,null,function*(){let z=C.view.ma(V);z.ns&&(z=yield Rf(O.localStore,C.query,!1).then(({documents:w})=>C.view.ma(w,z)));let j=B&&B.targetChanges.get(C.targetId),ie=B&&B.targetMismatches.get(C.targetId)!=null,G=C.view.applyChanges(z,O.isPrimaryClient,j,ie);return kf(O,C.targetId,G.wa),G.snapshot})}(n,v,T,R);let s=yield Rf(n.localStore,e,!0),a=new yu(e,s.Ts),c=a.ma(s.documents),h=qr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(c,n.isPrimaryClient,h);kf(n,t,d.wa);let p=new vu(e,t,a);return n.Fa.set(e,p),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),d.snapshot})}function Nw(n,e,t){return y(this,null,function*(){let r=q(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(a=>!Us(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield iu(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&zu(r.remoteStore,i.targetId),Eu(r,i.targetId)}).catch(Yr))):(Eu(r,i.targetId),yield iu(r.localStore,i.targetId,!0))})}function kw(n,e){return y(this,null,function*(){let t=q(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),zu(t.remoteStore,r.targetId))})}function Ow(n,e,t){return y(this,null,function*(){let r=Bw(n);try{let i=yield function(a,c){let h=q(a),d=pe.now(),p=c.reduce((R,D)=>R.add(D.key),K()),v,T;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let D=lt(),O=K();return h.cs.getEntries(R,p).next(C=>{D=C,D.forEach((V,B)=>{B.isValidDocument()||(O=O.add(V))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,D)).next(C=>{v=C;let V=[];for(let B of c){let z=BI(B,v.get(B.key).overlayedDocument);z!=null&&V.push(new He(B.key,z,zf(z.value.mapValue),kt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,V,c)}).next(C=>{T=C;let V=C.applyToLocalDocumentSet(v,O);return h.documentOverlayCache.saveOverlays(R,C.batchId,V)})}).then(()=>({batchId:T.batchId,changes:ep(v)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,c,h){let d=a.Ba[a.currentUser.toKey()];d||(d=new re(J)),d=d.insert(c,h),a.Ba[a.currentUser.toKey()]=d}(r,i.batchId,t),yield ei(r,i.changes),yield $s(r.remoteStore)}catch(i){let s=Qu(i,"Failed to persist write");t.reject(s)}})}function Pp(n,e){return y(this,null,function*(){let t=q(n);try{let r=yield uw(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Na.get(s);a&&(X(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?X(a.va):i.removedDocuments.size>0&&(X(a.va),a.va=!1))}),yield ei(t,r,e)}catch(r){yield Yr(r)}})}function Nf(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,a)=>{let c=a.view.Z_(e);c.snapshot&&i.push(c.snapshot)}),function(a,c){let h=q(a);h.onlineState=c;let d=!1;h.queries.forEach((p,v)=>{for(let T of v.j_)T.Z_(c)&&(d=!0)}),d&&Hu(h)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function xw(n,e,t){return y(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let a=new re(M.comparator);a=a.insert(s,Le.newNoDocument(s,$.min()));let c=K().add(s),h=new ds($.min(),new Map,new re(J),a,c);yield Pp(r,h),r.Oa=r.Oa.remove(s),r.Na.delete(e),Ju(r)}else yield iu(r.localStore,e,!1).then(()=>Eu(r,e,t)).catch(Yr)})}function Vw(n,e){return y(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield cw(t.localStore,e);Dp(t,r,null),Cp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ei(t,i)}catch(i){yield Yr(i)}})}function Lw(n,e,t){return y(this,null,function*(){let r=q(n);try{let i=yield function(a,c){let h=q(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,c).next(v=>(X(v!==null),p=v.keys(),h.mutationQueue.removeMutationBatch(d,v))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,c)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})}(r.localStore,e);Dp(r,e,t),Cp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ei(r,i)}catch(i){yield Yr(i)}})}function Cp(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Dp(n,e,t){let r=q(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function Eu(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Np(n,r)})}function Np(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(zu(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Ju(n))}function kf(n,e,t){for(let r of t)r instanceof Ss?(n.La.addReference(r.key,e),Mw(n,r)):r instanceof Rs?(L("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Np(n,r.key)):U()}function Mw(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(L("SyncEngine","New document in limbo: "+t),n.xa.add(r),Ju(n))}function Ju(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new M(te.fromString(e)),r=n.qa.next();n.Na.set(r,new Iu(t)),n.Oa=n.Oa.insert(t,r),vp(n.remoteStore,new jr(We(qu(t.path)),r,"TargetPurposeLimboResolution",Bf.oe))}}function ei(n,e,t){return y(this,null,function*(){let r=q(n),i=[],s=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((c,h)=>{a.push(r.Ka(h,e,t).then(d=>{var p;if((d||t)&&r.isPrimaryClient){let v=d?!d.fromCache:(p=t?.targetChanges.get(h.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(h.targetId,v?"current":"not-current")}if(d){i.push(d);let v=eu.Wi(h.targetId,d);s.push(v)}}))}),yield Promise.all(a),r.Ca.d_(i),yield function(h,d){return y(this,null,function*(){let p=q(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",v=>N.forEach(d,T=>N.forEach(T.$i,R=>p.persistence.referenceDelegate.addReference(v,T.targetId,R)).next(()=>N.forEach(T.Ui,R=>p.persistence.referenceDelegate.removeReference(v,T.targetId,R)))))}catch(v){if(!Xr(v))throw v;L("LocalStore","Failed to update sequence numbers: "+v)}for(let v of d){let T=v.targetId;if(!v.fromCache){let R=p.os.get(T),D=R.snapshotVersion,O=R.withLastLimboFreeSnapshotVersion(D);p.os=p.os.insert(T,O)}}})}(r.localStore,s))})}function Fw(n,e){return y(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){L("SyncEngine","User change. New user:",e.toKey());let r=yield _p(t.localStore,e);t.currentUser=e,function(s,a){s.ka.forEach(c=>{c.forEach(h=>{h.reject(new x(P.CANCELLED,a))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ei(t,r.hs)}})}function Uw(n,e){let t=q(n),r=t.Na.get(e);if(r&&r.va)return K().add(r.key);{let i=K(),s=t.Ma.get(e);if(!s)return i;for(let a of s){let c=t.Fa.get(a);i=i.unionWith(c.view.Va)}return i}}function kp(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Pp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Uw.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xw.bind(null,e),e.Ca.d_=Sw.bind(null,e.eventManager),e.Ca.$a=Rw.bind(null,e.eventManager),e}function Bw(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Vw.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Lw.bind(null,e),e}var Ps=class{constructor(){this.synchronizeTabs=!1}initialize(e){return y(this,null,function*(){this.serializer=qs(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return aw(this.persistence,new nu,e.initialUser,this.serializer)}createPersistence(e){return new Yc(Zc.Zr,this.serializer)}createSharedClientState(e){return new su}terminate(){return y(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Tu=class{initialize(e,t){return y(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Nf(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Fw.bind(null,this.syncEngine),yield bw(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new gu}()}createDatastore(e){let t=qs(e.databaseInfo.databaseId),r=function(s){return new cu(s)}(e.databaseInfo);return function(s,a,c,h){return new hu(s,a,c,h)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,a,c){return new fu(r,i,s,a,c)}(this.localStore,this.datastore,e.asyncQueue,t=>Nf(this.syncEngine,t,0),function(){return vs.D()?new vs:new ou}())}createSyncEngine(e,t){return function(i,s,a,c,h,d,p){let v=new wu(i,s,a,c,h,d);return p&&(v.Qa=!0),v}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return y(this,null,function*(){var e,t;yield function(i){return y(this,null,function*(){let s=q(i);L("RemoteStore","RemoteStore shutting down."),s.L_.add(5),yield Zr(s),s.k_.shutdown(),s.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}};var Cs=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):ct("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Au=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=de.UNAUTHENTICATED,this.clientId=ss.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>y(this,null,function*(){L("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(L("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ze;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>y(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Qu(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function ec(n,e){return y(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),L("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>y(this,null,function*(){r.isEqual(i)||(yield _p(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Of(n,e){return y(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield jw(n);L("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Pf(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Pf(e.remoteStore,i)),n._onlineComponents=e})}function qw(n){return n.name==="FirebaseError"?n.code===P.FAILED_PRECONDITION||n.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function jw(n){return y(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ec(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!qw(t))throw t;Nn("Error using user provided cache. Falling back to memory cache: "+t),yield ec(n,new Ps)}}else L("FirestoreClient","Using default OfflineComponentProvider"),yield ec(n,new Ps);return n._offlineComponents})}function Op(n){return y(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(L("FirestoreClient","Using user provided OnlineComponentProvider"),yield Of(n,n._uninitializedComponentsProvider._online)):(L("FirestoreClient","Using default OnlineComponentProvider"),yield Of(n,new Tu))),n._onlineComponents})}function $w(n){return Op(n).then(e=>e.syncEngine)}function bu(n){return y(this,null,function*(){let e=yield Op(n),t=e.eventManager;return t.onListen=Pw.bind(null,e.syncEngine),t.onUnlisten=Nw.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Cw.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=kw.bind(null,e.syncEngine),t})}function zw(n,e,t={}){let r=new ze;return n.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return function(s,a,c,h,d){let p=new Cs({next:T=>{a.enqueueAndForget(()=>Sp(s,v)),T.fromCache&&h.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(T)},error:T=>d.reject(T)}),v=new bs(c,p,{includeMetadataChanges:!0,_a:!0});return bp(s,v)}(yield bu(n),n.asyncQueue,e,t,r)})),r.promise}function xp(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var xf=new Map;function Vp(n,e,t){if(!t)throw new x(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Gw(n,e,t,r){if(e===!0&&r===!0)throw new x(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Vf(n){if(!M.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Lf(n){if(M.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function zs(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":U()}function at(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=zs(n);throw new x(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Ds=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Gw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xp((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},jn=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ds({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ds(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new tc;switch(r.type){case"firstParty":return new sc(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=xf.get(t);r&&(L("ComponentProvider","Removing Datastore"),xf.delete(t),r.terminate())}(this),Promise.resolve()}};function Lp(n,e,t,r={}){var i;let s=(n=at(n,jn))._getSettings(),a=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&Nn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let c,h;if(typeof r.mockUserToken=="string")c=r.mockUserToken,h=de.MOCK_USER;else{c=Uh(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new de(d)}n._authCredentials=new nc(new is(c,h))}}var cn=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},be=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ot(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Ot=class n extends cn{constructor(e,t,r){super(e,t,qu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new be(this.firestore,null,new M(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Mp(n,e,...t){if(n=se(n),Vp("collection","path",e),n instanceof jn){let r=te.fromString(e,...t);return Lf(r),new Ot(n,null,r)}{if(!(n instanceof be||n instanceof Ot))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return Lf(r),new Ot(n.firestore,null,r)}}function Yu(n,e,...t){if(n=se(n),arguments.length===1&&(e=ss.newId()),Vp("doc","path",e),n instanceof jn){let r=te.fromString(e,...t);return Vf(r),new be(n,null,new M(r))}{if(!(n instanceof be||n instanceof Ot))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return Vf(r),new be(n.firestore,n instanceof Ot?n.converter:null,new M(r))}}var Su=class{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Is(this,"async_queue_retry"),this.Eu=()=>{let t=Za();t&&L("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};let e=Za();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;let t=Za();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});let t=new ze;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){return y(this,null,function*(){if(this.uu.length!==0){try{yield this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!Xr(e))throw e;L("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}})}Au(e){let t=this.au.then(()=>(this.Pu=!0,e().catch(r=>{this.hu=r,this.Pu=!1;let i=function(a){let c=a.message||"";return a.stack&&(c=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),c}(r);throw ct("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Pu=!1,r))));return this.au=t,t}enqueueAfterDelay(e,t,r){this.du(),this.Tu.indexOf(e)>-1&&(t=0);let i=pu.createAndSchedule(this,e,t,r,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&U()}verifyOperationInProgress(){}mu(){return y(this,null,function*(){let e;do e=this.au,yield e;while(e!==this.au)})}fu(e){for(let t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.lu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){let t=this.lu.indexOf(e);this.lu.splice(t,1)}};function Mf(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Mt=class extends jn{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Su}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Up(this),this._firestoreClient.terminate()}};function Fp(n,e){let t=typeof n=="object"?n:yn(),r=typeof n=="string"?n:e||"(default)",i=vr(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Fh("firestore");s&&Lp(i,...s)}return i}function Xu(n){return n._firestoreClient||Up(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Up(n){var e,t,r;let i=n._freezeSettings(),s=function(c,h,d,p){return new lc(c,h,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,xp(p.experimentalLongPollingOptions),p.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Au(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}var Gr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(we.fromBase64String(e))}catch(t){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(we.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var $n=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new De(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Wr=class{constructor(e){this._methodName=e}};var Kr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}};var Qr=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var Ww=/^__.*__$/,Ru=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new He(e,this.data,this.fieldMask,t,this.fieldTransforms):new an(e,this.data,t,this.fieldTransforms)}},Ns=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new He(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Bp(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var Pu=class n{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.vu(e),i}Cu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return Os(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(Bp(this.wu)&&Ww.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}},Cu=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||qs(e)}Nu(e,t,r,i=!1){return new Pu({wu:e,methodName:t,Ou:r,path:De.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Zu(n){let e=n._freezeSettings(),t=qs(n._databaseId);return new Cu(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Kw(n,e,t,r,i,s={}){let a=n.Nu(s.merge||s.mergeFields?2:0,e,t,i);el("Data must be an object, but it was:",a,r);let c=qp(r,a),h,d;if(s.merge)h=new Oe(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let p=[];for(let v of s.mergeFields){let T=Du(e,v,t);if(!a.contains(T))throw new x(P.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);$p(p,T)||p.push(T)}h=new Oe(p),d=a.fieldTransforms.filter(v=>h.covers(v.field))}else h=null,d=a.fieldTransforms;return new Ru(new Ce(c),h,d)}var ks=class n extends Wr{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function Qw(n,e,t,r){let i=n.Nu(1,e,t);el("Data must be an object, but it was:",i,r);let s=[],a=Ce.empty();un(r,(h,d)=>{let p=tl(e,h,t);d=se(d);let v=i.Cu(p);if(d instanceof ks)s.push(p);else{let T=ti(d,v);T!=null&&(s.push(p),a.set(p,T))}});let c=new Oe(s);return new Ns(a,c,i.fieldTransforms)}function Hw(n,e,t,r,i,s){let a=n.Nu(1,e,t),c=[Du(e,r,t)],h=[i];if(s.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<s.length;T+=2)c.push(Du(e,s[T])),h.push(s[T+1]);let d=[],p=Ce.empty();for(let T=c.length-1;T>=0;--T)if(!$p(d,c[T])){let R=c[T],D=h[T];D=se(D);let O=a.Cu(R);if(D instanceof ks)d.push(R);else{let C=ti(D,O);C!=null&&(d.push(R),p.set(R,C))}}let v=new Oe(d);return new Ns(p,v,a.fieldTransforms)}function Jw(n,e,t,r=!1){return ti(t,n.Nu(r?4:3,e))}function ti(n,e){if(jp(n=se(n)))return el("Unsupported field value:",e,n),qp(n,e);if(n instanceof Wr)return function(r,i){if(!Bp(i.wu))throw i.Mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(r,i){let s=[],a=0;for(let c of r){let h=ti(c,i.Fu(a));h==null&&(h={nullValue:"NULL_VALUE"}),s.push(h),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=se(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return VI(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=pe.fromDate(r);return{timestampValue:gs(i.serializer,s)}}if(r instanceof pe){let s=new pe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:gs(i.serializer,s)}}if(r instanceof Kr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Gr)return{bytesValue:lp(i.serializer,r._byteString)};if(r instanceof be){let s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.Mu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:$u(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Qr)return function(a,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw c.Mu("VectorValues must only contain numeric values.");return ju(c.serializer,h)})}}}}}}(r,i);throw i.Mu(`Unsupported field value: ${zs(r)}`)}(n,e)}function qp(n,e){let t={};return qf(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):un(n,(r,i)=>{let s=ti(i,e.bu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function jp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof pe||n instanceof Kr||n instanceof Gr||n instanceof be||n instanceof Wr||n instanceof Qr)}function el(n,e,t){if(!jp(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=zs(t);throw r==="an object"?e.Mu(n+" a custom object"):e.Mu(n+" "+r)}}function Du(n,e,t){if((e=se(e))instanceof $n)return e._internalPath;if(typeof e=="string")return tl(n,e);throw Os("Field path arguments must be of type string or ",n,!1,void 0,t)}var Yw=new RegExp("[~\\*/\\[\\]]");function tl(n,e,t){if(e.search(Yw)>=0)throw Os(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new $n(...e.split("."))._internalPath}catch{throw Os(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Os(n,e,t,r,i){let s=r&&!r.isEmpty(),a=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let h="";return(s||a)&&(h+=" (found",s&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new x(P.INVALID_ARGUMENT,c+n+h)}function $p(n,e){return n.some(t=>t.isEqual(e))}var xs=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new be(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Nu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(nl("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Nu=class extends xs{data(){return super.data()}};function nl(n,e){return typeof e=="string"?tl(n,e):e instanceof $n?e._internalPath:e._delegate._internalPath}function zp(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Hr=class{},ku=class extends Hr{};function Gp(n,e,...t){let r=[];e instanceof Hr&&r.push(e),r=r.concat(t),function(s){let a=s.filter(h=>h instanceof Ou).length,c=s.filter(h=>h instanceof Vs).length;if(a>1||a>0&&c>0)throw new x(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Vs=class n extends ku{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Kp(e._query,t),new cn(e.firestore,e.converter,Tc(e._query,t))}_parse(e){let t=Zu(e.firestore);return function(s,a,c,h,d,p,v){let T;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new x(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Uf(v,p);let R=[];for(let D of v)R.push(Ff(h,s,D));T={arrayValue:{values:R}}}else T=Ff(h,s,v)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Uf(v,p),T=Jw(c,a,v,p==="in"||p==="not-in");return ce.create(d,p,T)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Wp(n,e,t){let r=e,i=nl("where",n);return Vs._create(i,r,t)}var Ou=class n extends Hr{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Me.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let a=i,c=s.getFlattenedFilters();for(let h of c)Kp(a,h),a=Tc(a,h)}(e._query,t),new cn(e.firestore,e.converter,Tc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function Ff(n,e,t){if(typeof(t=se(t))=="string"){if(t==="")throw new x(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jf(e)&&t.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(te.fromString(t));if(!M.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return lf(n,new M(r))}if(t instanceof be)return lf(n,t._key);throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${zs(t)}.`)}function Uf(n,e){if(!Array.isArray(n)||n.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Kp(n,e){let t=function(i,s){for(let a of i)for(let c of a.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var xu=class{convertValue(e,t="none"){switch(nn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(xt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return un(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>ee(a.doubleValue));return new Qr(s)}convertGeoPoint(e){return new Kr(ee(e.latitude),ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Mu(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ur(e));default:return null}}convertTimestamp(e){let t=ut(e);return new pe(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=te.fromString(e);X(gp(r));let i=new us(r.get(1),r.get(3)),s=new M(r.popFirst(5));return i.isEqual(t)||ct(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Xw(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Zt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Ls=class extends xs{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Dn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(nl("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Dn=class extends Ls{data(e={}){return super.data(e)}},Ms=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Zt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Dn(this._firestore,this._userDataWriter,r.key,r,new Zt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(c=>{let h=new Dn(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Zt(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let h=new Dn(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Zt(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),p=a.indexOf(c.doc.key)),{type:Zw(c.type),doc:h,oldIndex:d,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Zw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}var Jr=class extends xu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};function Qp(n){n=at(n,cn);let e=at(n.firestore,Mt),t=Xu(e),r=new Jr(e);return zp(n._query),zw(t,n._query).then(i=>new Ms(e,r,n,i))}function Hp(n,e,t,...r){n=at(n,be);let i=at(n.firestore,Mt),s=Zu(i),a;return a=typeof(e=se(e))=="string"||e instanceof $n?Hw(s,"updateDoc",n._key,e,t,r):Qw(s,"updateDoc",n._key,e),Yp(i,[a.toMutation(n._key,kt.exists(!0))])}function Jp(n,e){let t=at(n.firestore,Mt),r=Yu(n),i=Xw(n.converter,e);return Yp(t,[Kw(Zu(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,kt.exists(!1))]).then(()=>r)}function rl(n,...e){var t,r,i;n=se(n);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Mf(e[a])||(s=e[a],a++);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Mf(e[a])){let v=e[a];e[a]=(t=v.next)===null||t===void 0?void 0:t.bind(v),e[a+1]=(r=v.error)===null||r===void 0?void 0:r.bind(v),e[a+2]=(i=v.complete)===null||i===void 0?void 0:i.bind(v)}let h,d,p;if(n instanceof be)d=at(n.firestore,Mt),p=qu(n._key.path),h={next:v=>{e[a]&&e[a](eE(d,n,v))},error:e[a+1],complete:e[a+2]};else{let v=at(n,cn);d=at(v.firestore,Mt),p=v._query;let T=new Jr(d);h={next:R=>{e[a]&&e[a](new Ms(d,T,v,R))},error:e[a+1],complete:e[a+2]},zp(n._query)}return function(T,R,D,O){let C=new Cs(O),V=new bs(R,C,D);return T.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return bp(yield bu(T),V)})),()=>{C.za(),T.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return Sp(yield bu(T),V)}))}}(Xu(d),p,c,h)}function Yp(n,e){return function(r,i){let s=new ze;return r.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return Ow(yield $w(r),i,s)})),s.promise}(Xu(n),e)}function eE(n,e,t){let r=t.docs.get(e._key),i=new Jr(n);return new Ls(n,i,e._key,r,new Zt(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){zn=i})(St),bt(new ke("firestore",(r,{instanceIdentifier:i,options:s})=>{let a=r.getProvider("app").getImmediate(),c=new Mt(new rc(r.getProvider("auth-internal")),new ac(r.getProvider("app-check-internal")),function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new us(d.options.projectId,p)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),ue(of,"4.7.1",e),ue(of,"4.7.1","esm2017")})();var Gs=function(){return Gs=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Gs.apply(this,arguments)};var rE={includeMetadataChanges:!1};function Xp(n,e){return e===void 0&&(e=rE),new gt(function(t){var r=rl(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function Zp(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Gs(Gs({},r),(t={},t[e.idField]=n.id,t))}function em(n){return Xp(n,{includeMetadataChanges:!0}).pipe(_t(function(e){return e.docs}))}function tm(n,e){return e===void 0&&(e={}),em(n).pipe(_t(function(t){return t.map(function(r){return Zp(r,e)})}))}var ni=class{constructor(e){return e}},nm="firestore",il=class{constructor(){return Ir(nm)}};var sl=new Ae("angularfire2.firestore-instances");function iE(n,e){let t=ki(nm,n,e);return t&&new ni(t)}function sE(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ni(r)}}var oE={provide:il,deps:[[new Ne,sl]]},aE={provide:ni,useFactory:iE,deps:[[new Ne,sl],nt]};function h0(n,...e){return ue("angularfire",Gt.full,"fst"),vt([aE,oE,{provide:sl,useFactory:sE(n),multi:!0,deps:[Ue,mn,wn,Wt,[new Ne,Dr],[new Ne,In],...e]}])}var d0=he(tm,!0);var f0=he(Jp,!0);var p0=he(Mp,!0);var m0=he(Yu,!0);var g0=he(Qp,!0);var _0=he(Fp,!0);var y0=he(Gp,!0);var v0=he(Hp,!0);var I0=he(Wp,!0);export{zm as a,ug as b,RE as c,gT as d,_T as e,Cr as f,lA as g,hA as h,dA as i,fA as j,pA as k,mA as l,ni as m,h0 as n,d0 as o,f0 as p,p0 as q,m0 as r,g0 as s,_0 as t,y0 as u,v0 as v,I0 as w};
